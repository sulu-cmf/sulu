define([],function(){"use strict";var a=0,b=1,c=2,d=3,e=4,f={operatorsUrl:null,fieldsUrl:null,eventNamespace:"sulu.condition-selection",dataAttribute:"condition-selection",instanceName:"condition",translations:{addButton:"resource.filter.add-condition"},data:[],validationSelector:null},g={container:function(a,b){return['<div class="',a,'" id="',b,'" style="display:none"></div>'].join("")},button:function(a,b){return['<div class="grid-row">','<div class="grid-col-3">','<div id="',a,'" class="btn action">',b,"</div>","</div>","</div>"].join("")},row:function(a,b){return['<div class="',a,' grid-row" data-id="',b,'"></div>'].join("")},removeButton:function(a){return['<div class="grid-col-1 align-center pointer ',a,'">','<span class="fa-minus-circle m-top-5"></span>',"</div>"].join("")},input:function(a,b){return['<input data-validation-required="true" class="form-element husky-validate ',b,'" type="text" value="',a,'">'].join("")},col:function(a){return['<div class="',a,'"></div>'].join("")},select:function(a){return['<select data-validation-required="true" class="form-element husky-validate ',a,'"></select>'].join("")}},h={valueInputClass:"value-input",conditionContainerClass:"conditions-container",conditionRowClass:"condition-row",operatorSelectClass:"operator-select",fieldSelectClass:"field-select",removeButtonClass:"condition-remove"},i=function(){return l.call(this,"initialized")},j=function(){return"data-changed"},k=function(){return l.call(this,"data-changed")},l=function(a){return this.options.eventNamespace+"."+(this.options.instanceName?this.options.instanceName+".":"")+a},m=function(){var a=this.sandbox.dom.createElement('<div id="'+this.options.ids.loader+'"></div>');this.sandbox.dom.append(this.options.el,a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"100px",color:"#cccccc"}}])},n=function(){this.sandbox.stop("#"+this.options.ids.loader)},o=function(){this.options.data&&this.options.data.length>0&&this.options.data.forEach(function(a){p.call(this,a)}.bind(this))},p=function(a){var b,c,d,e,f,i,j={},k=[],l=a?a.id:"new";b=this.sandbox.dom.createElement(g.row(h.conditionRowClass,l)),c=this.sandbox.dom.createElement(g.removeButton(h.removeButtonClass)),a?(j=a.conditions[0],k=y.call(this,j.type),d=r.call(this,j.field,!1,!0)):d=r.call(this,j.field,!0,!0),f=u.call(this,j.operator,j.type),e=q.call(this,f,k,!1,!0),i=s.call(this,a,f,"grid-col-4",!0),this.sandbox.dom.append(b,c),this.sandbox.dom.append(b,d),this.sandbox.dom.append(b,e),this.sandbox.dom.append(b,i),this.sandbox.dom.append(this.$container,b)},q=function(a,b,c,d){var e,f=A.call(this,a?a.id:null,"id","name",b,h.operatorSelectClass,c);return a&&this.sandbox.dom.data(f,"type",a.type),d?(e=this.sandbox.dom.createElement(g.col("grid-col-3")),this.sandbox.dom.append(e,f),e):f},r=function(a,b,c){var d,e=A.call(this,a,"name","translation",this.fields,h.fieldSelectClass,b);return c?(d=this.sandbox.dom.createElement(g.col("grid-col-4")),this.sandbox.dom.append(d,e),d):e},s=function(a,b,c,d){var e,f,i,j=null;return a&&b?a.conditions.length>1?this.sandbox.logger.error("Multiple conditions not yet supported!"):(f=a.conditions[0],j=v.call(this,b,f.value),i=f.id):j=!a&&b?v.call(this,b,""):x.call(this,"",h.valueInputClass),this.options.validationSelector&&this.sandbox.form.addField(this.options.validationSelector,j),this.sandbox.dom.data(j,"id",i),d?(e=this.sandbox.dom.createElement(g.col(c)),this.sandbox.dom.append(e,j),e):j},t=function(a){var b=null;return a=parseInt(a),this.operators.forEach(function(c){return c.id===a?(b=c,!1):void 0}.bind(this)),b},u=function(a,b){var c=null;return"string"==typeof b&&(b=z.call(this,b)),this.operators.forEach(function(d){return d.operator===a&&d.type===b?(c=d,!1):void 0}.bind(this)),c},v=function(a,b){switch(a.inputType){case"date":case"datepicker":return w.call(this,b,h.valueInputClass);case"select":case"boolean":case"radio":case"checkbox":return A.call(this,b,"value","name",a.values,h.valueInputClass,!0);case"":case"simple":return x.call(this,b,h.valueInputClass);default:this.sandbox.logger.error('Input type "'+type+'" is not supported!')}},w=function(a,b){var c=this.sandbox.dom.createElement('<div class="'+b+'"></div>');return this.sandbox.start([{name:"input@husky",options:{el:c,datepickerOptions:{startDate:"1900-01-01",endDate:new Date},skin:"date",value:a}}]),c},x=function(a,b){return this.sandbox.dom.createElement(g.input(a,b))},y=function(b){var c=[];return b="string"==typeof b?z.call(this,b):b||a,this.operators.forEach(function(a){a.type===b&&c.push(a)}.bind(this)),c},z=function(a){switch(a){case"string":return b;case"number":case"integer":case"float":return c;case"boolean":return e;case"date":case"datetime":return d;default:return this.sandbox.logger.error('Unsupported type "'+a+'" found!'),null}},A=function(a,b,c,d,e,f){var h=[],i=null,j=this.sandbox.dom.createElement(g.select.call(this,e));return f&&h.push('<option value=""></option>'),d.forEach(function(d){i=this.sandbox.translate(d[c]),h.push(d[b]===a?'<option value="'+d[b]+'" selected>'+i+"</option>":'<option value="'+d[b]+'">'+i+"</option>")}.bind(this)),this.options.validationSelector&&this.sandbox.form.addField(this.options.validationSelector,j),this.sandbox.dom.append(j,h.join("")),j},B=function(){var a=this.sandbox.translate(this.options.translations.addButton),b=this.sandbox.dom.createElement(g.button.call(this,this.options.ids.addButton,a));this.sandbox.dom.append(this.options.el,b)},C=function(){this.sandbox.dom.on(this.options.el,"click",J.bind(this),"#"+this.options.ids.addButton),this.sandbox.dom.on(this.$container,"click",K.bind(this),"."+h.removeButtonClass),this.sandbox.dom.on(this.$container,"change",H.bind(this),"."+h.fieldSelectClass),this.sandbox.dom.on(this.$container,"change",G.bind(this),"."+h.operatorSelectClass),this.sandbox.dom.on(this.$el,j.call(this),E.bind(this)),this.sandbox.dom.on(this.$container,"change",function(){O.call(this)}.bind(this),"select"),this.sandbox.dom.on(this.$container,"change",function(){O.call(this)}.bind(this),"input"),this.sandbox.dom.on(this.$container,"change",function(a){D.call(this,a)}.bind(this),"select."+h.operatorSelectClass)},D=function(a){var b=a.currentTarget,c=this.sandbox.dom.val(b),d=t.call(this,c);this.sandbox.dom.data(b,"type",d.type)},E=function(){var a=this.sandbox.dom.data(this.options.el,"condition-selection");F.call(this,a),O.call(this)},F=function(a){var b=this.sandbox.dom.find("."+h.conditionRowClass,this.$container);this.sandbox.dom.each(b,function(a,b){L.call(this,b)}.bind(this)),this.options.data=a,o.call(this)},G=function(){var a=event.target.value,b=this.sandbox.dom.closest(event.target,"."+h.conditionRowClass),c=t.call(this,a),d=this.sandbox.dom.find("."+h.valueInputClass,b)[0],e=this.sandbox.dom.parent(d);this.options.validationSelector&&this.sandbox.form.removeField(this.options.validationSelector,d),this.sandbox.stop(d),this.sandbox.dom.remove(d),d=s.call(this,null,c,null,!1),this.sandbox.dom.append(e,d)},H=function(a){var b=a.target.value,c=I.call(this,b),d=y.call(this,c.type),e=this.sandbox.dom.closest(a.target,"."+h.conditionRowClass),f=this.sandbox.dom.find("."+h.operatorSelectClass,e)[0],g=this.sandbox.dom.find("."+h.valueInputClass,e)[0],i=this.sandbox.dom.parent(f),j=this.sandbox.dom.parent(g);this.options.validationSelector&&(this.sandbox.form.removeField(this.options.validationSelector,g),this.sandbox.form.removeField(this.options.validationSelector,f)),this.sandbox.dom.remove(f),this.sandbox.stop(g),this.sandbox.dom.remove(g),f=q.call(this,null,d,!0,!1),g=s.call(this),this.sandbox.dom.append(i,f),this.sandbox.dom.append(j,g)},I=function(a){var b={type:"string"};return this.fields.forEach(function(c){return c.name===a?(b=c,!1):void 0}.bind(this)),b},J=function(){p.call(this),this.sandbox.emit(k.call(this))},K=function(a){var b=this.sandbox.dom.closest(a.currentTarget,"."+h.conditionRowClass);L.call(this,b)},L=function(a){var b=(this.sandbox.dom.data(a,"id"),this.sandbox.dom.find("."+h.fieldSelectClass,a)),c=this.sandbox.dom.find("."+h.operatorSelectClass,a),d=this.sandbox.dom.find("."+h.valueInputClass,a);this.options.validationSelector&&(this.sandbox.form.removeField(this.options.validationSelector,b),this.sandbox.form.removeField(this.options.validationSelector,c),this.sandbox.form.removeField(this.options.validationSelector,d)),this.sandbox.dom.remove(a),O.call(this),this.sandbox.emit(k.call(this))},M=function(a){var b,c,d,e,f,g,i,j={conditions:[]},k=this.sandbox.dom.data(a,"id");return k&&"new"!==k&&(j.id=k),b=this.sandbox.dom.val(this.sandbox.dom.find("."+h.fieldSelectClass,a)),d=this.sandbox.dom.data(this.sandbox.dom.find("."+h.operatorSelectClass,a),"type"),c=this.sandbox.dom.val(this.sandbox.dom.find("."+h.operatorSelectClass,a)),f=this.sandbox.dom.data(this.sandbox.dom.find("."+h.valueInputClass,a),"id"),i=t.call(this,c),e=this.sandbox.dom.val(i&&"datepicker"===i.inputType?this.sandbox.dom.find("."+h.valueInputClass+" input",a):this.sandbox.dom.find("."+h.valueInputClass,a)),g={type:d,field:b,operator:i?i.operator:null,value:e},f&&(g.id=f),j.conditions.push(g),j},N=function(){var a=[],b=this.sandbox.dom.find("."+h.conditionRowClass,this.$container);return this.sandbox.dom.each(b,function(b,c){a.push(M.call(this,c))}.bind(this)),a},O=function(){this.data=N.call(this),this.sandbox.dom.data(this.options.el,"conditionSelection",this.data)};return{initialize:function(){this.options=this.sandbox.util.extend(!0,{},f,this.options),this.options.ids={loader:"condition-selection-"+this.options.instanceName+"-loader",container:"condition-selection-"+this.options.instanceName+"-container",addButton:"condition-selection-"+this.options.instanceName+"-add-button"},m.call(this),this.fetchOperatorsAndFields()},fetchOperatorsAndFields:function(){var a,b;this.options.operatorsUrl&&"string"==typeof this.options.operatorsUrl&&this.options.fieldsUrl&&"string"==typeof this.options.fieldsUrl?(a=this.sandbox.util.load(this.options.operatorsUrl),b=this.sandbox.util.load(this.options.fieldsUrl),this.sandbox.data.when(a,b).done(function(a,b){this.operators=a[0]._embedded.items,this.fields=b[0],this.render()}.bind(this))):this.sandbox.logger.error("Url for fields and/or operators not specified or invalid!")},render:function(){this.$container=this.sandbox.dom.createElement(g.container(h.conditionContainerClass,this.options.ids.container)),this.sandbox.dom.append(this.options.el,this.$container),this.options.data&&o.call(this),B.call(this),n.call(this),this.sandbox.dom.show(this.$container),C.call(this),this.sandbox.emit(i.call(this))}}});