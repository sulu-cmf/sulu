define(["filtersutil/header"],function(a){"use strict";var b="#filter-form",c=60;return{name:"Sulu Filter Form",view:!0,templates:["/admin/resource/template/filter/form"],header:function(){return{toolbar:{template:"default",languageChanger:{preSelected:this.options.locale}}}},initialize:function(){this.saved=!0,this.initializeValidation(),this.bindCustomEvents(),this.setHeaderBar(!0),this.render(),this.listenForChange()},bindCustomEvents:function(){this.sandbox.on("sulu.header.toolbar.save",function(){this.save()}.bind(this)),this.sandbox.on("sulu.header.toolbar.delete",function(){this.sandbox.emit("sulu.resource.filter.delete",this.sandbox.dom.val("#id"))}.bind(this)),this.sandbox.on("sulu.resource.filter.saved",function(a){this.options.data.id=a,this.setHeaderBar(!0),this.setHeaderInformation()},this),this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.resource.filter.list")},this),this.sandbox.on("sulu.header.initialized",function(){this.setHeaderInformation()},this)},initializeValidation:function(){this.sandbox.form.create(b)},save:function(){if(this.sandbox.form.validate(b)){var a=this.sandbox.form.getData(b);""===a.id&&delete a.id,a.type={id:1},this.sandbox.emit("sulu.product.attributes.save",a)}},render:function(){this.setHeaderInformation(),this.initForm(this.options.data)},initForm:function(a){var c=this.sandbox.form.create(b);c.initialized.then(function(){this.setFormData(a)}.bind(this))},setFormData:function(a){this.sandbox.form.setData(b,a).then(function(){this.sandbox.start(b)}.bind(this)).fail(function(a){this.sandbox.logger.error("An error occured when setting data!",a)}.bind(this))},setHeaderInformation:function(){this.setHeaderTitle(),this.setBreadCrumb()},setHeaderTitle:function(){var a="resource.filter";this.options.data&&this.options.data.name&&(a=this.options.data.name),a=this.sandbox.util.cropTail(a,c),this.sandbox.emit("sulu.header.set-title",a)},setBreadCrumb:function(){var a=Config.get("suluresource.filters.type."+this.options.type),b=[];this.options.type&&a&&a.breadCrumb&&(b=Config.get("suluresource.filters.type."+this.options.type).breadCrumb),b.push({title:"resource.filter"}),this.options.data&&this.options.data.id&&b.push({title:"#"+this.options.data.id}),this.sandbox.emit("sulu.header.set-breadcrumb",b)},setHeaderBar:function(a){if(a!==this.saved){var b=this.options.data&&this.options.data.id?"edit":"add";this.sandbox.emit("sulu.header.toolbar.state.change",b,a,!0)}this.saved=a},listenForChange:function(){this.sandbox.dom.on("#attribute-form","change",function(){this.setHeaderBar(!1)}.bind(this),"select"),this.sandbox.dom.on("#attribute-form","keyup",function(){this.setHeaderBar(!1)}.bind(this),"input, textarea"),this.sandbox.on("sulu.content.changed",function(){this.setHeaderBar(!1)}.bind(this)),this.sandbox.on("husky.select.attribute-types.selected.item",function(a){this.toggleValuesList(a),this.setHeaderBar(!1)}.bind(this))},toggleValuesList:function(a){}}});