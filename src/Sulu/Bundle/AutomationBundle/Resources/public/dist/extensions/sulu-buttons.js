define(["underscore","services/husky/util","services/husky/translator"],function(a,b,c){"use strict";var d={scheduled:c.translate("sulu_automation.info.scheduled"),setBy:c.translate("sulu_automation.info.set-by"),"goto":c.translate("sulu_automation.info.goto")},e=a.template(["<p>","    <b><%= translations.scheduled %>: <%= taskName %></b><br>","    <%= schedule %><br>","    <%= translations.setBy %> <%= creator %>","</p>",'<p class="smaller"><%= translations.goto %></p>'].join("")),f=function(a){return b.load("/admin/api/tasks?limit=1&schedule=future&sortBy=schedule&sortOrder=asc&entity-class="+a.entityClass+"&entity-id="+a.entityId+"&handler-class="+a.handlerClass.join(","))},g=function(a){return e({translations:d,taskName:c.translate(a.taskName),schedule:window.Husky.date.format(a.schedule,!0),creator:a.creator})},h=function(a,b){f(a).then(function(c){return a.hidden=0===c.total,0===c.total?b.addClass("hidden"):(b.removeClass("hidden"),b.html(g(c._embedded.tasks[0])),a)})};return{getDropdownItems:function(){return[{name:"automationInfo",template:{initialize:function(a,b,c){return c.on("sulu.automation.task.create",h.bind(this,a,b)),c.on("sulu.automation.task.update",h.bind(this,a,b)),c.on("sulu.automation.task.remove",h.bind(this,a,b)),f(a).then(function(b){return a.hidden=0===b.total,a.hidden?a:(a.title=g(b._embedded.tasks[0]),a)}.bind(this))}.bind(this),styleClass:"info",link:!1}}]}}});