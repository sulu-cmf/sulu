define([],function(){"use strict";var a={toolbar:{resolutions:[1920,1680,1440,1024,800,600,480],showLeft:!0,showRight:!0},mainContentElementIdentifier:"",iframeSource:{url:"",webspace:"",language:"",template:"",id:""}},b={breakPointBig:980,breakPointSmall:640,breakPointSmallExpanded:600,minWidthForToolbarCollapsed:240,minWidthForToolbarExpanded:240,mainContentMaxWidthIncMarginLeft:920,mainContentMaxWidth:820,mainContentMinWidthIncMarginLeft:510,mainContentMinWidth:460,marginPreviewCollapsedLeft:30,marginPreviewExpandedLeft:10,previewMinWidth:30,transitionDuration:500,minMainContentMarginLeft:10,maxMainContentMarginLeft:50,maxMainContentPaddingLeft:50,toolbarLeft:"preview-toolbar-left",toolbarRight:"preview-toolbar-right",toolbarNewWindow:"preview-toolbar-new-window",toolbarResolutions:"preview-toolbar-resolutions"},c="husky.preview.",d=c+"initialized",e=c+"expending",f=c+"collapsing",g=c+"hide";return{initialize:function(){this.options=this.sandbox.util.extend({},a,this.options),this.url="",this.isExpanded=!1,this.iframeExists=!1,this.$wrapper=null,this.$iframe=null,this.$toolbar=null,this.$mainContent=this.sandbox.dom.$("#"+this.options.mainContentElementIdentifier)[0],this.render(),this.bindDomEvents(),this.bindCustomEvents(),this.adjustDisplayedComponents(),this.sandbox.emit(d)},render:function(){this.url=this.getUrl(this.options.iframeSource.url,this.options.iframeSource.webspace,this.options.iframeSource.language,this.options.iframeSource.id,this.options.iframeSource.template);var a=this.calculateCurrentWidths(!1,!1);this.renderWrapper(a),this.renderIframe(a.preview,this.url),this.renderToolbar(a),this.sandbox.emit("sulu.app.content.dimensions-change",{width:a.content,left:b.maxMainContentMarginLeft,paddingLeft:b.maxMainContentPaddingLeft})},renderWrapper:function(a){return this.$mainContent?(this.$wrapper=this.sandbox.dom.$('<div class="preview-wrapper" id="preview-wrapper" style=""></div>'),this.sandbox.dom.css(this.$wrapper,"width",a.preview+"px"),void this.sandbox.dom.append(this.$el,this.$wrapper)):void this.sandbox.logger.error("main content element could not be found!")},renderIframe:function(a,b){this.$iframe=this.sandbox.dom.$('<iframe id="preview-iframe" class="preview-iframe" src="'+b+'" width="'+a+'px" height="100%"></iframe>'),this.sandbox.dom.append(this.$wrapper,this.$iframe),this.iframeExists=!0},renderToolbar:function(a){var c=this.sandbox.translate("content.preview.resolutions");this.$toolbar=this.sandbox.dom.$(['<div id="preview-toolbar" class="preview-toolbar">','<div id="',b.toolbarLeft,'" class="left pointer collapsed"><span class="fa-chevron-left"></span></div>','<div id="',b.toolbarRight,'" class="right">','<div id="',b.toolbarNewWindow,'" class="new-window pull-right pointer"><span class="fa-external-link"></span></div>','<div id="',b.toolbarResolutions,'" class="resolutions pull-right pointer">','<label class="drop-down-trigger">','<span class="dropdown-label">',c,"</span>",'<span class="dropdown-toggle"></span>',"</label>","</div>","</div>","</div>"].join("")),this.sandbox.dom.css(this.$toolbar,"width",a.preview+30+"px"),this.sandbox.dom.append(this.$el,this.$toolbar),this.$toolbarRight=this.sandbox.dom.find("#"+b.toolbarRight,this.$toolbar),this.$toolbarResolutionsLabel=this.sandbox.dom.find(".dropdown-label",this.$toolbarRight),this.$toolbarResolutions=this.sandbox.dom.find("#"+b.toolbarResolutions,this.$toolbarRight),this.$toolbarOpenNewWindow=this.sandbox.dom.find("#"+b.toolbarNewWindow,this.$toolbarRight),this.$toolbarLeft=this.sandbox.dom.find("#"+b.toolbarLeft,this.$toolbar),a.preview<b.minWidthForToolbarCollapsed&&this.sandbox.dom.addClass(this.$toolbarRight,"hidden"),this.renderResolutionDropdown()},renderResolutionDropdown:function(){var a=this.getResolutions();a.length>0&&this.sandbox.start([{name:"dropdown@husky",options:{el:"#"+b.toolbarResolutions,trigger:".drop-down-trigger",setParentDropDown:!0,instanceName:"resolutionsDropdown",alignment:"left",data:a}}])},bindDomEvents:function(){this.sandbox.dom.on("#"+b.toolbarLeft,"click",function(a){var b=a.currentTarget;this.isExpanded?this.collapsePreview(b):this.expandPreview(b)}.bind(this)),this.sandbox.dom.on("#"+b.toolbarNewWindow,"click",function(){var a=this.sandbox.dom.find("#"+b.toolbarLeft,this.$el);this.collapsePreview(a),window.open(this.url),this.sandbox.dom.hide(this.$wrapper),this.sandbox.dom.hide(this.$toolbar),this.sandbox.dom.remove(this.$iframe),this.iframeExists=!1,this.sandbox.emit("husky.navigation.show"),this.sandbox.emit("sulu.header.content.show-back",!0),this.sandbox.emit("sulu.app.content.dimensions-change",{width:"",left:b.maxMainContentMarginLeft,paddingLeft:b.maxMainContentPaddingLeft}),this.sandbox.dom.width(this.$mainContent,""),this.sandbox.emit(g)}.bind(this))},bindCustomEvents:function(){this.sandbox.on("husky.dropdown.resolutionsDropdown.showing",function(){var a=this.sandbox.dom.find("#"+b.toolbarResolutions,this.$toolbarRight),c=this.sandbox.dom.find(".dropdown-menu",a);this.sandbox.dom.width(c,a.outerWidth()),this.sandbox.dom.width(a,a.outerWidth())}.bind(this)),this.sandbox.on("husky.dropdown.resolutionsDropdown.item.click",function(a){this.sandbox.dom.text(this.$toolbarResolutionsLabel,a.name)}.bind(this)),this.sandbox.on("sulu.app.viewport.dimensions-changed",this.adjustDisplayedComponents.bind(this)),this.sandbox.on("sulu.content.preview.change-url",function(a){this.sandbox.dom.remove(this.$iframe),this.iframeExists=!1;var b=this.calculateCurrentWidths(this.isExpanded,!0);this.options.iframeSource=this.sandbox.util.extend({},this.options.iframeSource,a),this.restoreIframe(b.preview)}.bind(this))},expandPreview:function(a){var c=this.sandbox.dom.find("span",a),d=this.calculateCurrentWidths(!0,!1);this.sandbox.emit("sulu.header.tabs.activate"),this.sandbox.dom.removeClass(a,"collapsed"),this.sandbox.dom.addClass(a,"expanded"),this.sandbox.dom.addClass(c,"fa-chevron-right"),this.sandbox.dom.removeClass(c,"fa-chevron-left"),this.sandbox.emit(e),this.isExpanded=!0,d.preview<b.minWidthForToolbarExpanded?(this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","left")):(this.sandbox.dom.show(this.$toolbarRight),this.sandbox.dom.show(this.$toolbarResolutions),this.sandbox.dom.css(this.$toolbarRight,"float","right")),this.animateCollapseAndExpand(!0,d)},collapsePreview:function(a){this.sandbox.emit("sulu.header.tabs.deactivate");var c=this.sandbox.dom.find("span",a),d=this.calculateCurrentWidths(!1,!1),e=this.sandbox.dom.width(window);this.sandbox.dom.removeClass(a,"expanded"),this.sandbox.dom.addClass(a,"collapsed"),this.sandbox.dom.removeClass(c,"fa-chevron-right"),this.sandbox.dom.addClass(c,"fa-chevron-left"),this.sandbox.emit(f),this.isExpanded=!1,e<b.breakPointSmall?(this.adjustDisplayedComponents(),this.sandbox.dom.css(this.$toolbarRight,"float","right")):d.preview<b.minWidthForToolbarCollapsed&&(this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","left")),this.animateCollapseAndExpand(!1,d)},animateCollapseAndExpand:function(a,c){this.sandbox.dom.animate(this.$wrapper,{width:c.preview+"px"},{duration:b.transitionDuration,queue:!1}),this.sandbox.dom.animate(this.$iframe,{width:c.preview+"px"},{duration:b.transitionDuration,queue:!1}),this.sandbox.dom.animate(this.$toolbar,{width:c.preview+b.marginPreviewCollapsedLeft+"px"},{duration:b.transitionDuration,queue:!1}),a?(this.sandbox.emit("husky.navigation.hide"),this.sandbox.emit("sulu.header.hide-back",!0),this.sandbox.emit("sulu.app.content.dimensions-change",{width:c.content,left:b.minMainContentMarginLeft,paddingLeft:0})):(this.sandbox.emit("husky.navigation.show"),this.sandbox.emit("sulu.header.show-back",!0),this.sandbox.emit("sulu.app.content.dimensions-change",{width:c.content,left:b.maxMainContentMarginLeft,paddingLeft:b.maxMainContentPaddingLeft}))},adjustDisplayedComponents:function(){var a=this.calculateCurrentWidths(this.isExpanded,!0);this.isExpanded?this.isExpanded&&(a.preview<b.previewMinWidth?(this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.hide(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","right")):a.preview<b.minWidthForToolbarExpanded?(this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","left")):(this.sandbox.dom.show(this.$toolbarResolutions),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","right"))):a.content<=b.breakPointSmall+b.previewMinWidth?(this.sandbox.dom.hide(this.$iframe),this.sandbox.dom.hide(this.$wrapper),this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.hide(this.$toolbarLeft),this.sandbox.dom.show(this.$toolbar),this.sandbox.dom.show(this.$toolbarRight),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.remove(this.$iframe),this.iframeExists=!1,this.sandbox.dom.css(this.$toolbarRight,"float","right"),a.content=""):a.preview<b.minWidthForToolbarCollapsed?(this.restoreIframe(a.preview),this.showNecessaryDOMElements(),this.sandbox.dom.hide(this.$toolbarResolutions),this.sandbox.dom.css(this.$toolbarRight,"float","left")):(this.restoreIframe(a.preview),this.showNecessaryDOMElements(),this.sandbox.dom.show(this.$toolbarResolutions),this.sandbox.dom.css(this.$toolbarRight,"float","right")),this.sandbox.dom.width(this.$wrapper,a.preview),this.sandbox.dom.width(this.$iframe,a.preview),this.sandbox.dom.width(this.$toolbar,a.preview+b.marginPreviewCollapsedLeft),this.sandbox.dom.width(this.$mainContent,a.content)},restoreIframe:function(a){if(!this.iframeExists){var b=this.getUrl(this.options.iframeSource.url,this.options.iframeSource.webspace,this.options.iframeSource.language,this.options.iframeSource.id,this.options.iframeSource.template);this.renderIframe(a,b),this.iframeExists=!0}},showNecessaryDOMElements:function(){this.sandbox.dom.show(this.$toolbar),this.sandbox.dom.show(this.$toolbarLeft),this.sandbox.dom.show(this.$toolbarRight),this.sandbox.dom.show(this.$wrapper),this.sandbox.dom.show(this.$iframe),this.sandbox.dom.show(this.$toolbarOpenNewWindow),this.sandbox.dom.css(this.$toolbarRight,"float","right")},calculateCurrentWidths:function(a,c){var d,e={preview:0,content:0},f=this.sandbox.dom.width(window),g=0;return a?(e.preview=f-b.mainContentMinWidth-b.marginPreviewExpandedLeft-b.minMainContentMarginLeft,e.content=c?b.mainContentMinWidth:b.mainContentMinWidthIncMarginLeft):(c&&f<b.breakPointBig&&(g=b.maxMainContentMarginLeft+b.maxMainContentPaddingLeft),d=f-b.previewMinWidth-b.marginPreviewCollapsedLeft-g,d>b.mainContentMaxWidthIncMarginLeft?(e.content=b.mainContentMaxWidthIncMarginLeft,e.preview=f-e.content-b.marginPreviewCollapsedLeft):(e.content=d,e.preview=b.previewMinWidth)),e},getUrl:function(a,b,c,d,e){return a&&d&&b&&c&&e?(a="/"===a[a.length-1]?a:a+"/",a+=d+"?",a+="webspace="+b,a+="&language="+c,a+="&template="+e):(this.sandbox.logger.error("not all url params for iframe definded!"),"")},getResolutions:function(){for(var a=[],b=0;b<this.options.toolbar.resolutions.length;)a.push({id:b,name:this.options.toolbar.resolutions[b]+" px",value:this.options.toolbar.resolutions[b]}),++b;return a}}});