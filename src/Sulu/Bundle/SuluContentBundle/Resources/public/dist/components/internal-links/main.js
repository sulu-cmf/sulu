define([],function(){"use strict";var a={visibleItems:999,instanceName:null,url:"",idsParameter:"ids",preselected:{ids:[]},idKey:"id",titleKey:"title",resultKey:"",columnNavigationUrl:"",translations:{noLinksSelected:"internal-links.nolinks-selected",addLinks:"internal-links.add",visible:"public.visible",of:"public.of"}},b={ids:[],displayOption:"top",config:{}},c="sulu.internal-links.",d=function(){return f.call(this,"input-retrieved")},e=function(){return f.call(this,"data-changed")},f=function(a){return c+(this.options.instanceName?this.options.instanceName+".":"")+a},g={skeleton:function(a){return['<div class="white-box form-element" id="',a.ids.container,'">','   <div class="header">','       <span class="fa-plus-circle icon left action" id="',a.ids.addButton,'"></span>','       <span class="fa-cog icon right border " id="',a.ids.configButton,'" style="display: none;"></span>',"   </div>",'   <div class="content" id="',a.ids.content,'"></div>',"</div>"].join("")},noContent:function(a){return['<div class="no-content">','   <span class="fa-coffee icon"></span>','   <div class="text">',a,"</div>","</div>"].join("")},data:function(a){return['<div id="',a.ids.columnNavigation,'"/>'].join("")},contentItem:function(a,b,c){return['<li data-id="',a,'">','   <span class="num">',b,"</span>",'   <span class="value">',c,"</span>",'   <span class="fa-times remove"></span>',"</li>"].join("")}},h=function(a){return"#"+this.options.ids[a]},i=function(){if(this.options.ids={container:"internal-links-"+this.options.instanceName+"-container",addButton:"internal-links-"+this.options.instanceName+"-add",configButton:"internal-links-"+this.options.instanceName+"-config",displayOption:"internal-links-"+this.options.instanceName+"-display-option",content:"internal-links-"+this.options.instanceName+"-content",chooseTab:"internal-links-"+this.options.instanceName+"-choose-tab",columnNavigation:"internal-links-"+this.options.instanceName+"-column-navigation"},this.sandbox.dom.html(this.$el,g.skeleton(this.options)),this.$container=this.sandbox.dom.find(h.call(this,"container"),this.$el),this.$content=this.sandbox.dom.find(h.call(this,"content"),this.$el),this.$addButton=this.sandbox.dom.find(h.call(this,"addButton"),this.$el),this.$configButton=this.sandbox.dom.find(h.call(this,"configButton"),this.$el),this.sandbox.dom.data(this.$el,"internal-links")){var a=this.sandbox.util.extend(!0,{},b,this.sandbox.dom.data(this.$el,"internal-links"));x.call(this,a)}else x.call(this,this.options.preselected);j.call(this),k.call(this),this.itemsVisible=this.options.visibleItems,this.URI={str:"",hasChanged:!1},y.call(this),z.call(this),t.call(this),w.call(this),p.call(this)},j=function(){var a=this.sandbox.translate(this.options.translations.noLinksSelected);this.sandbox.dom.html(this.$content,g.noContent(a))},k=function(){this.sandbox.on("husky.overlay.internal-links."+this.options.instanceName+".add.initialized",o.bind(this)),this.sandbox.on("husky.column-navigation."+this.options.instanceName+".edit",l.bind(this)),this.sandbox.on(d.call(this),function(){y.call(this),w.call(this)}.bind(this)),this.sandbox.on("husky.column-navigation."+this.options.instanceName+".initialized",function(){this.sandbox.emit("husky.overlay.internal-links."+this.options.instanceName+".add.set-position")}.bind(this))},l=function(a){-1===this.data.ids.indexOf(a.id)&&(this.data.ids.push(a.id),this.items.push(a),this.$find(".items-list").length?(r.call(this,a),v.call(this),this.itemsVisible=this.options.visibleItems,s.call(this)):q.call(this),x.call(this,this.data),this.sandbox.emit(e.call(this),this.data,this.$el))},m=function(a){var b=this.sandbox.dom.parents(a.currentTarget,"li"),c=this.sandbox.dom.data(b,"id");this.sandbox.dom.remove(b),this.data.ids.splice(this.data.ids.indexOf(c),1),n.call(this,c),v.call(this),0===this.items.length?j.call(this):(this.itemsVisible=this.options.visibleItems,s.call(this)),this.sandbox.emit("husky.column-navigation."+this.options.instanceName+".unmark",c),x.call(this,this.data),this.sandbox.emit(e.call(this),this.data,this.$el)},n=function(a){for(var b=-1,c=this.items.length;++b<c;)if(a===this.items[b].id)return this.items.splice(b,1),!0;return!1},o=function(){this.sandbox.start([{name:"column-navigation@husky",options:{el:h.call(this,"columnNavigation"),url:this.options.columnNavigationUrl,instanceName:this.options.instanceName,editIcon:"fa-plus-circle",resultKey:this.options.resultKey,showEdit:!1,showStatus:!1,responsive:!1,skin:"fixed-height-small",markable:!0,premarkedIds:this.data.ids}}])},p=function(){this.sandbox.dom.on(h.call(this,"displayOption"),"change",function(){x.call(this,{displayOption:this.sandbox.dom.val(h.call(this,"displayOption"))}),this.sandbox.emit(e.call(this),this.data,this.$el)}.bind(this)),this.sandbox.dom.on(this.$el,"click",m.bind(this),".items-list .remove")},q=function(){if(0!==this.items.length){this.linkList=this.sandbox.dom.createElement('<ul class="items-list"/>');for(var a=-1,b=this.items.length;++a<b&&a<this.itemsVisible;)r.call(this,this.items[a]);this.sandbox.dom.html(this.$content,this.linkList),s.call(this)}else j.call(this),v.call(this)},r=function(a){this.sandbox.dom.append(this.linkList,g.contentItem(a[this.options.idKey],this.sandbox.dom.find("li",this.linkList).length+1,a[this.options.titleKey]))},s=function(){this.itemsVisible=this.items.length<this.itemsVisible?this.items.length:this.itemsVisible,(null===this.$footer||void 0===this.$footer)&&(this.$footer=this.sandbox.dom.createElement('<div class="footer"/>')),this.sandbox.dom.html(this.$footer,["<span>","<strong>"+this.itemsVisible+" </strong>",this.sandbox.translate(this.options.translations.of)," ","<strong>"+this.items.length+" </strong>",this.sandbox.translate(this.options.translations.visible),"</span>"].join("")),this.sandbox.dom.append(this.$container,this.$footer)},t=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$addButton,cssClass:"internal-links-overlay",el:a,container:this.$el,instanceName:"internal-links."+this.options.instanceName+".add",skin:"wide",slides:[{title:this.sandbox.translate(this.options.translations.addLinks),cssClass:"internal-links-overlay-add",data:g.data(this.options)}]}}])},u=function(){v.call(this);var a=this.sandbox.dom.createElement('<div class="loader"/>');this.sandbox.dom.html(this.$content,a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"100px",color:"#e4e4e4"}}])},v=function(){null!==this.$footer&&this.sandbox.dom.remove(this.$footer)},w=function(){if(this.URI.hasChanged===!0){var a=function(a){this.items=a._embedded[this.options.resultKey]||[],q.call(this)}.bind(this);u.call(this),this.itemsVisible=this.options.visibleItems,this.data.ids&&this.data.ids.length>0?this.sandbox.util.load(this.URI.str).then(a.bind(this)).fail(function(a){this.sandbox.logger.log(a)}.bind(this)):a.call(this,{_embedded:[]})}},x=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.data[b]=a[b]);this.sandbox.dom.data(this.$el,"internal-links",this.data)},y=function(){var a=-1===this.options.url.indexOf("?")?"?":"&",b=[this.options.url,a,this.options.idsParameter,"=",(this.data.ids||[]).join(",")].join("");b!==this.URI.str?(this.URI.str=b,this.URI.hasChanged=!0):this.URI.hasChanged=!1},z=function(){this.sandbox.dom.val(h.call(this,"displayOption"),this.data.displayOption)};return{historyClosed:!0,initialize:function(){this.options=this.sandbox.util.extend({},a,this.options),this.data={},this.linkList=null,i.call(this)}}});