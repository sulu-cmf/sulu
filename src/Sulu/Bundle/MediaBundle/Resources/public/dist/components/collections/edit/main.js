define(["services/sulumedia/collection-manager","services/sulumedia/user-settings-manager","services/sulumedia/media-router","services/sulumedia/overlay-manager","sulusecurity/services/security-checker"],function(a,b,c,d,e){"use strict";var f={};return{collaboration:function(){return this.options.id?{id:this.options.id,type:"collection"}:void 0},header:function(){return{noBack:!this.data.id,tabs:{url:"/admin/content-navigations?alias=media",options:{getData:function(){return this.sandbox.util.deepCopy(this.data)}.bind(this)},componentOptions:{values:this.data}},toolbar:{buttons:this.getHeaderButtons(),languageChanger:{url:"/admin/api/localizations",resultKey:"localizations",titleAttribute:"localization",preSelected:this.options.locale}}}},getHeaderButtons:function(){var a={add:{options:{title:"sulu.media.add-collection"}}};return this.options.id&&(a.edit={options:{title:"sulu.header.edit-collection",dropdownItems:{}}},e.hasPermission(this.data,"edit")&&!this.data.locked&&(a.edit.options.dropdownItems.editCollection={},a.edit.options.dropdownItems.moveCollection={}),e.hasPermission(this.data,"delete")&&!this.data.locked&&(a.edit.options.dropdownItems.deleteCollection={}),this.sandbox.util.isEmpty(a.edit.options.dropdownItems)&&delete a.edit,e.hasPermission(this.data,"security")&&!this.data.locked&&(a.permissionSettings={})),a},loadComponentData:function(){var d=$.Deferred();return this.options.id?(a.load(this.options.id,this.options.locale).then(function(a){d.resolve(a)}).fail(function(){d.reject(),b.setLastVisitedCollection(null),c.toRootCollection()}),d):{title:this.sandbox.translate("sulu.media.all-collections"),hasSub:!0}},initialize:function(){this.options=this.sandbox.util.extend(!0,{},f,this.options),b.setLastVisitedCollection(this.data.id),this.bindCustomEvents(),this.bindOverlayEvents(),this.bindManagerEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.header.back",this.routeToParent.bind(this)),this.sandbox.on("sulu.toolbar.add",this.addHandler.bind(this)),this.sandbox.on("sulu.toolbar.delete-collection",this.deleteCollection.bind(this)),this.sandbox.on("sulu.header.language-changed",this.languageChangedHandler.bind(this)),this.sandbox.on("sulu.media.collection-create.created",function(a){c.toCollection(a.id,this.options.locale)}.bind(this)),this.sandbox.on("sulu.toolbar.edit-collection",function(){d.startEditCollectionOverlay.call(this,this.data.id,this.options.locale)}.bind(this)),this.sandbox.on("sulu.toolbar.move-collection",function(){d.startMoveCollectionOverlay.call(this,this.data.id,this.options.locale)}.bind(this)),this.sandbox.on("sulu.toolbar.collection-permissions",function(){d.startPermissionSettingsOverlay.call(this,this.data.id,"Sulu\\Bundle\\MediaBundle\\Entity\\Collection","sulu.media.collections")}.bind(this))},bindOverlayEvents:function(){this.sandbox.on("sulu.collection-select.move-collection.selected",this.moveCollection.bind(this))},bindManagerEvents:function(){this.sandbox.on("sulu.medias.collection.saved",this.savedHandler.bind(this)),this.sandbox.on("sulu.medias.collection.deleted",this.routeToParent.bind(this))},savedHandler:function(a,b){b.locale&&b.locale!==this.options.locale||(this.data=b,this.sandbox.emit("sulu.header.saved",this.data))},addHandler:function(){d.startCreateCollectionOverlay.call(this,this.data)},routeToParent:function(){this.data._embedded.parent?c.toCollection(this.data._embedded.parent.id,this.options.locale):c.toRootCollection(this.options.locale)},languageChangedHandler:function(a){b.setMediaLocale(a.id),this.data.id?c.toCollection(this.data.id,a.id):c.toRootCollection(a.id)},deleteCollection:function(){this.sandbox.sulu.showDeleteDialog(function(b){b&&a["delete"](this.data.id)}.bind(this),"sulu.header.delete-collection")},moveCollection:function(b){a.move(this.data.id,b.id,this.options.locale).then(function(){c.toCollection(this.data.id,this.options.locale)}.bind(this))}}});