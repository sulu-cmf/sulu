define(["config","services/sulumedia/collection-manager","services/sulumedia/media-manager","services/sulumedia/media-router","services/sulumedia/user-settings-manager","services/sulumedia/overlay-manager"],function(a,b,c,d,e,f){"use strict";var g={instanceName:"collection"},h={hideToolbarClass:"toolbar-hidden",datagridSelector:".datagrid-container",collectionTitleSelector:".content-title h2"};return{layout:{content:{width:"max"}},initialize:function(){var a=$('<div class="collection-view"/>');this.options=this.sandbox.util.extend(!0,{},g,this.options),this.data=this.options.getData(),this.$el.append(a),this.sandbox.start([{name:"collection-view@sulumedia",options:{el:a,data:this.data,locale:this.options.locale,instanceName:this.options.instanceName,assetActions:["fa-pencil",{icon:"fa-crop",type:"image",action:function(a){this.editMedia(a.id,!0)}.bind(this)}]}}]),this.bindCollectionViewEvents(),this.bindManagerEvents(),this.bindOverlayEvents(),this.options.editId&&this.editMedia(this.options.editId)},bindCollectionViewEvents:function(){this.sandbox.on("sulu.collection-view."+this.options.instanceName+".folder.clicked",function(a){d.toCollection(a,this.options.locale)}.bind(this)),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".folder.add-clicked",f.startCreateCollectionOverlay.bind(this,this.data)),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".asset.edit-clicked",this.editMedias,this),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".asset.delete-clicked",this.deleteMedia,this),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".asset.move-clicked",function(){f.startMoveMediaOverlay.call(this,this.data.id,this.options.locale)}.bind(this)),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".asset.clicked",this.editMedia,this),this.sandbox.on("sulu.collection-view."+this.options.instanceName+".folder.breadcrumb-clicked",this.breadcrumbClickHandler,this)},bindManagerEvents:function(){this.sandbox.on("sulu.medias.media.saved",function(a,b){b.locale&&b.locale!==this.options.locale||this.sandbox.emit("husky.datagrid."+this.options.instanceName+".records.change",this.sandbox.util.extend(!0,{},b,{type:b.type.name?b.type.name:b.type}))}.bind(this)),this.sandbox.on("sulu.medias.media.deleted",function(a){this.sandbox.emit("husky.datagrid."+this.options.instanceName+".record.remove",a)}.bind(this)),this.sandbox.on("sulu.medias.media.moved",function(a){this.sandbox.emit("husky.datagrid."+this.options.instanceName+".record.remove",a)}.bind(this))},bindOverlayEvents:function(){this.sandbox.on("sulu.collection-select.move-media.selected",this.moveMedia,this),this.sandbox.on("sulu.medias.collection.saved",this.savedHandler,this)},savedHandler:function(a,b){b.locale&&b.locale!==this.options.locale||$(h.collectionTitleSelector).text(b.title)},moveMedia:function(a){this.sandbox.emit("husky.datagrid."+this.options.instanceName+".items.get-selected",function(b){c.move(b,a.id,this.options.locale),this.sandbox.emit("husky.datagrid."+this.data.id+".children.records.get",function(c){c.forEach(function(c){c.id===a.id&&this.sandbox.emit("husky.datagrid."+this.data.id+".children.records.change",_.extend(c,{mediaCount:c.mediaCount+b.length}))}.bind(this))}.bind(this))}.bind(this))},editMedias:function(a){f.startEditMediaOverlay.call(this,a,this.options.locale)},editMedia:function(a,b){var c="edit";b===!0&&(c="crop"),f.startEditMediaOverlay.call(this,[a],this.options.locale,c)},deleteMedia:function(a){this.sandbox.sulu.showDeleteDialog(function(b){b&&c["delete"](a)}.bind(this))},breadcrumbClickHandler:function(a){a.data.id?d.toCollection(a.data.id,this.options.locale):d.toRootCollection(this.options.locale)}}});