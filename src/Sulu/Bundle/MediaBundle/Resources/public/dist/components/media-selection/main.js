define(["underscore"],function(a){"use strict";var b={eventNamespace:"sulu.media-selection",thumbnailKey:"thumbnails",thumbnailSize:"50x50",resultKey:"media",dataAttribute:"media-selection",actionIcon:"fa-file-image-o",types:null,navigateEvent:"sulu.router.navigate",locale:"",dataDefault:{displayOption:"top",ids:[]},hideConfigButton:!0,translations:{noContentSelected:"media-selection.nomedia-selected",addImages:"media-selection.add-images",choose:"public.choose",collections:"media-selection.collections",upload:"media-selection.upload-new",collection:"media-selection.upload-to-collection",createNewCollection:"media-selection.create-new-collection",newCollection:"media-selection.new-collection"}},c=function(){return d.call(this,"record-deselected")},d=function(a){return this.options.eventNamespace+"."+(this.options.instanceName?this.options.instanceName+".":"")+a},e={contentItem:function(a,b,c,d,e){var f=['<a href="#" class="link" data-id="',a,'" data-collection="',b,'">'];return d&&f.push(['    <img src="',d,'"/>'].join("")),e&&f.push('    <span class="badge">',e,"</span>"),f.push('    <span class="title">',c,"</span>","</a>"),f.join("")}},f=function(){this.sandbox.on(this.DISPLAY_OPTION_CHANGED(),function(a){i.call(this,{displayOption:a},!1)},this),this.sandbox.on(this.DATA_RETRIEVED(),function(a){var b=[];this.sandbox.util.foreach(a,function(a){b.push(a.id)}.bind(this)),i.call(this,{ids:b},!1)},this),this.sandbox.on("sulu.media-selection."+this.options.instanceName+".add-button-clicked",function(){var b=a.map(this.getData().ids,function(a){return{id:a}});this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".set-items",b),this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".open")}.bind(this))},g=function(){this.sandbox.dom.on(this.$el,"click",function(a){var b=this.sandbox.dom.data(a.currentTarget,"id"),c=this.sandbox.dom.data(a.currentTarget,"collection");return this.sandbox.emit(this.options.navigateEvent,"media/collections/edit:"+c+"/files/edit:"+b),!1}.bind(this),"a.link")},h=function(){var b=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,b),this.sandbox.start([{name:"media-selection/overlay@sulumedia",options:{el:b,instanceName:this.options.instanceName,preSelectedIds:a.map(this.getData().ids,function(a){return{id:a}}),removeOnClose:!1,autoStart:!1,removeable:!1,types:this.options.types,locale:this.options.locale,saveCallback:function(b){var c=this.getData();a.each(c.ids,this.removeItemById.bind(this)),c.ids=a.map(b,function(a){return this.addItem(a),a.id}.bind(this)),this.setData(c,!1)}.bind(this)}}])},i=function(a,b){var c=this.getData();for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);this.setData(c,b)};return{type:"itembox",initialize:function(){this.options=this.sandbox.util.extend(!0,{},b,this.options);var a=this.getData();this.options.ids={container:"media-selection-"+this.options.instanceName+"-container",addButton:"media-selection-"+this.options.instanceName+"-add",configButton:"media-selection-"+this.options.instanceName+"-config",displayOption:"media-selection-"+this.options.instanceName+"-display-option",content:"media-selection-"+this.options.instanceName+"-content",chooseTab:"media-selection-"+this.options.instanceName+"-choose-tab",uploadTab:"media-selection-"+this.options.instanceName+"-upload-tab",loader:"media-selection-"+this.options.instanceName+"-loader",collectionSelect:"media-selection-"+this.options.instanceName+"-collection-select",dropzone:"media-selection-"+this.options.instanceName+"-dropzone"},f.call(this),g.call(this),this.render(),a.displayOption&&this.setDisplayOption(a.displayOption),h.call(this)},isDataEmpty:function(a){return this.sandbox.util.isEmpty(a.ids)},getUrl:function(a){var b=-1===this.options.url.indexOf("?")?"?":"&";return[this.options.url,b,this.options.idsParameter,"=",(a.ids||[]).join(","),"&locale=",this.options.locale].join("")},getItemContent:function(a){return e.contentItem(a.id,a.collection,a.title,a.thumbnails?a.thumbnails[this.options.thumbnailSize]:null,a.locale!==this.options.locale?a.locale:null)},sortHandler:function(a){var b=this.getData();b.ids=a,this.setData(b,!1)},removeHandler:function(a){for(var b=this.getData(),d=-1,e=b.ids.length;++d<e;)if(b.ids[d]===a){b.ids.splice(b.ids.indexOf(a),1);break}this.sandbox.emit(c.call(this),a),this.setData(b,!1)}}});