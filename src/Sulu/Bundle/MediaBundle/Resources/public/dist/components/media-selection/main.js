define(function(){"use strict";var a={eventNamespace:"sulu.media-selection",thumbnailKey:"thumbnails",thumbnailSize:"50x50",resultKey:"media",dataAttribute:"media-selection",dataDefault:{displayOption:"top",ids:[]},hideConfigButton:!0,translations:{noContentSelected:"media-selection.nomedia-selected",addImages:"media-selection.add-images",choose:"public.choose",collections:"media-selection.collections",upload:"media-selection.upload-new",collection:"media-selection.upload-to-collection",createNewCollection:"media-selection.create-new-collection",newCollection:"media-selection.new-collection"}},b=function(){return d.call(this,"data-changed")},c=function(){return d.call(this,"record-deselected")},d=function(a){return this.options.eventNamespace+"."+(this.options.instanceName?this.options.instanceName+".":"")+a},e={contentItem:function(a,b){return['   <img src="',b["50x50"],'"/>','   <span class="title">',a,"</span>"].join("")}},f=function(){this.sandbox.on(this.DISPLAY_OPTION_CHANGED(),function(a){h.call(this,{displayOption:a},!1)},this),this.sandbox.on(this.DATA_RETRIEVED(),function(a){var b=[];this.sandbox.util.foreach(a,function(a){b.push(a.id)}.bind(this)),h.call(this,{ids:b},!1)},this),this.sandbox.on("sulu.media-selection-overlay."+this.options.instanceName+".record-selected",function(a,c){var d=this.getData(),e=d.ids.indexOf(a);e>-1||(d.ids.push(a),this.setData(d,!1),this.addItem(c),this.sandbox.emit(b.call(this)))}.bind(this)),this.sandbox.on("sulu.media-selection-overlay."+this.options.instanceName+".record-deselected",function(a){var c=this.getData(),d=c.ids.indexOf(a);d>-1&&c.ids.splice(d,1),this.setData(c,!1),this.removeItemById(a),this.sandbox.emit(b.call(this))}.bind(this)),this.sandbox.on("sulu.media-selection."+this.options.instanceName+".add-button-clicked",function(){this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".set-selected",this.getData().ids),this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".open")}.bind(this))},g=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"media-selection-overlay@sulumedia",options:{el:a,instanceName:this.options.instanceName,preSelectedIds:this.getData().ids}}])},h=function(a,b){var c=this.getData();for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);this.setData(c,b)};return{type:"itembox",initialize:function(){this.options=this.sandbox.util.extend(!0,{},a,this.options);var b=this.getData();this.options.ids={container:"media-selection-"+this.options.instanceName+"-container",addButton:"media-selection-"+this.options.instanceName+"-add",configButton:"media-selection-"+this.options.instanceName+"-config",displayOption:"media-selection-"+this.options.instanceName+"-display-option",content:"media-selection-"+this.options.instanceName+"-content",chooseTab:"media-selection-"+this.options.instanceName+"-choose-tab",uploadTab:"media-selection-"+this.options.instanceName+"-upload-tab",loader:"media-selection-"+this.options.instanceName+"-loader",collectionSelect:"media-selection-"+this.options.instanceName+"-collection-select",dropzone:"media-selection-"+this.options.instanceName+"-dropzone"},f.call(this),this.render(),b.displayOption&&this.setDisplayOption(b.displayOption),g.call(this)},isDataEmpty:function(a){return this.sandbox.util.isEmpty(a.ids)},getUrl:function(a){var b=-1===this.options.url.indexOf("?")?"?":"&";return[this.options.url,b,this.options.idsParameter,"=",(a.ids||[]).join(",")].join("")},getItemContent:function(a){return e.contentItem(a.title,a.thumbnails)},sortHandler:function(a){var b=this.getData();b.ids=a,this.setData(b,!1)},removeHandler:function(a){for(var b=this.getData(),d=-1,e=b.ids.length;++d<e;)if(b.ids[d]===a){b.ids.splice(b.ids.indexOf(a),1);break}this.sandbox.emit(c.call(this),a),this.setData(b,!1)}}});