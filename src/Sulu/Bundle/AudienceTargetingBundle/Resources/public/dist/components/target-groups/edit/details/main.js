define(["jquery","services/suluaudiencetargeting/target-group-manager","text!/admin/target-groups/template/target-group-details.html"],function(a,b,c){return{type:"form-tab",defaults:{templates:{form:c},translations:{all:"public.all",active:"sulu_audience_targeting.is-active",condition:"sulu_audience_targeting.conditions",description:"public.description",frequency:"sulu_audience_targeting.frequency",pleaseChoose:"public.please-choose",priority:"sulu_audience_targeting.priority",ruleSets:"sulu_audience_targeting.rule-sets",ruleSetsDescription:"sulu_audience_targeting.rule-sets-descriptions",title:"public.title",webspaces:"sulu_audience_targeting.webspaces"}},layout:function(){return{content:{width:"max",leftSpace:!1,rightSpace:!1}}},tabInitialize:function(){this.sandbox.on("sulu.content.changed",this.setDirty.bind(this)),this.sandbox.on("husky.toggler.is-active.changed",this.setDirty.bind(this))},parseData:function(a){return this.parsedData=a,a.webspaces=this.parseWebspaceForSelect(a.webspaces),a},save:function(a){a.webspaces=this.parseWebspaceSelection(this.retrieveSelectValue("#webspaces")),b.save(a).then(function(a){this.saved(a)}.bind(this))},parseWebspaceSelection:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push({webspaceKey:a[c]});return b},parseWebspaceForSelect:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push(a[c].webspaceKey);return b},getTemplate:function(){return this.templates.form({data:this.parsedData,translations:this.translations,translate:this.sandbox.translate})},getFormId:function(){return"#target-group-form"},retrieveSelectValue:function(b){var c=[],d=a(b);return d.length&&"undefined"!=typeof d.data("selection")&&(c=d.data("selection")),c},rendered:function(){this.startRulesList()},startRulesList:function(){var a=[];this.parsedData.rules&&(a=this.parsedData.rules.map(function(a){return{title:a.title,frequency:a.frequency,conditions:a.conditions.map(function(a){return a.type}).join(" & ")}})),this.sandbox.sulu.initListToolbarAndList.call(this,"rules",null,{el:this.$find("#rules-list-toolbar"),template:this.sandbox.sulu.buttons.get({add:{options:{position:0}},deleteSelected:{options:{position:1}}}),hasSearch:!1},{el:this.$find("#rules-list"),data:a,matchings:[{name:"title",content:this.translations.title},{name:"frequency",content:this.translations.frequency},{name:"conditions",content:this.translations.condition}]},"rules")}}});