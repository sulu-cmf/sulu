define(["services/suluaudiencetargeting/target-group-manager","services/suluaudiencetargeting/target-group-router","text!./list.html"],function(a,b,c){var d={templates:{list:c},translations:{title:"sulu_audience_targeting.target-groups"}};return{defaults:d,header:function(){return{title:this.translations.title,underline:!1,noBack:!0,toolbar:{buttons:{add:{options:{callback:function(){b.toAdd()}}},deleteSelected:{options:{callback:function(){this.sandbox.emit("husky.datagrid.target-groups.items.get-selected",this.showDeleteConfirmation.bind(this))}.bind(this)}}}}}},layout:{content:{width:"max"}},initialize:function(){this.render(),this.bindCustomEvents()},render:function(){this.$el.html(this.templates.list()),this.sandbox.sulu.initListToolbarAndList.call(this,"target-groups",a.getUrl()+"/fields",{el:this.$find("#list-toolbar-container"),instanceName:"target-groups",template:this.sandbox.sulu.buttons.get({settings:{options:{dropdownItems:[{type:"columnOptions"}]}}})},{el:this.sandbox.dom.find("#target-groups-list"),url:a.getUrl()+"?sortBy=id&sortOrder=desc",searchInstanceName:"target-groups",searchFields:["title"],resultKey:"target-groups",instanceName:"target-groups",actionCallback:function(a){b.toEdit(a)},contentFilters:{message:function(a){var b=document.createElement("div");return b.innerHTML=a,a=b.textContent||b.innerText,this.sandbox.util.cropMiddle(a,300)}.bind(this)},viewOptions:{table:{selectItem:{type:"checkbox",inFirstCell:!1}}}})},showDeleteConfirmation:function(a){this.sandbox.sulu.showDeleteDialog(function(b){b&&this.deleteItems(a)}.bind(this))},deleteItems:function(b){this.sandbox.emit("sulu.header.toolbar.item.loading","deleteSelected"),a.deleteMultiple(b).then(function(){for(var a in b)this.sandbox.emit("husky.datagrid.target-groups.record.remove",b[a]);this.sandbox.emit("sulu.header.toolbar.item.disable","deleteSelected")}.bind(this))},bindCustomEvents:function(){this.sandbox.on("husky.datagrid.target-groups.number.selections",function(a){var b=a>0?"enable":"disable";this.sandbox.emit("sulu.header.toolbar.item."+b,"deleteSelected",!1)}.bind(this))}}});