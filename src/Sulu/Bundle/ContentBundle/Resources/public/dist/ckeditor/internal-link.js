define(function(){"use strict";var a=function(a){var b=a.getStartElement(),c=b.getAscendant("sulu:link",!0);return c&&c.is("sulu:link")?{title:c.getText(),altTitle:c.getAttribute("title"),target:c.getAttribute("target"),href:c.getAttribute("href")}:{title:a.getSelectedText()}},b=function(a,b,c){var d=b.getStartElement();d&&d.is("sulu:link")||(d=a.document.createElement("sulu:link"),a.insertElement(d)),d.setAttribute("title",c.altTitle),d.setAttribute("href",c.href),d.setAttribute("target",c.target),d.setText(c.title)};return function(c){return{init:function(d){d.addCommand("internalLinkDialog",{dialogName:"internalLinkDialog",exec:function(){var e=$("<div/>");$("body").append(e),c.start([{name:"ckeditor-internal-link@sulucontent",options:{el:e,webspace:d.config.webspace,locale:d.config.locale,link:a(d.getSelection()),saveCallback:function(a){c.stop(e),b(d,d.getSelection(),a)}}}])}}),d.addCommand("removeInternalLink",{exec:function(){var b=d.getSelection(),c=a(b),e=b.getStartElement(),f=e.getAscendant("sulu:link",!0);f.remove(),d.insertText(c.title)},refresh:function(){var a=d.getSelection(),b=a.getStartElement();return b.getAscendant("sulu:link",!0)?void this.setState(CKEDITOR.TRISTATE_OFF):void this.setState(CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1}),d.ui.addButton("InternalLink",{label:c.translate("content.ckeditor.internal-link"),command:"internalLinkDialog",icon:"/bundles/sulucontent/img/icon_link_internal.png"}),d.ui.addButton("RemoveInternalLink",{label:c.translate("content.ckeditor.internal-link.remove"),command:"removeInternalLink",icon:"/bundles/sulucontent/img/icon_remove_link_internal.png"}),d.contextMenu&&(d.addMenuGroup("suluGroup"),d.addMenuItem("internalLinkItem",{label:c.translate("content.ckeditor.internal-link.edit"),icon:"/bundles/sulucontent/img/icon_link_internal.png",command:"internalLinkDialog",group:"suluGroup"}),d.addMenuItem("removeInternalLinkItem",{label:c.translate("content.ckeditor.internal-link.remove"),icon:"/bundles/sulucontent/img/icon_remove_link_internal.png",command:"removeInternalLink",group:"suluGroup"}),d.contextMenu.addListener(function(a){return a.getAscendant("sulu:link",!0)?{internalLinkItem:CKEDITOR.TRISTATE_OFF,removeInternalLinkItem:CKEDITOR.TRISTATE_OFF}:void 0}))},onLoad:function(){CKEDITOR.addCss("sulu\\:link { text-decoration: underline; color: #428bca; }")}}}});