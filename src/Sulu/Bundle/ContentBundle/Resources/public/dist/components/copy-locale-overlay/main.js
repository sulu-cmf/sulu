define(function(){"use strict";var a={copyFrom:"content.contents.settings.copy-locales.copy-from",target:"content.contents.settings.copy-locales.target",info:"content.contents.settings.copy-locales.info",title:"content.contents.settings.copy-locales.title",ok:"content.contents.settings.copy-locales.ok",defaultLabel:"content.contents.settings.copy-locales.default-label",currentLanguage:"content.contents.settings.copy-locales.current-language"},b={copyLocales:function(a){var d=['<div class="copy-locales-overlay-content">',"   <label>",c.call(this,"copyFrom"),"   </label>",'   <div class="grid m-top-10">','       <div class="grid-row">','       <div id="copy-locales-select" class="grid-col-6"/>',"   </div>","</div>",'<h2 class="divider m-top-20">',c.call(this,"target"),"</h2>",'<p class="info">',"   * ",c.call(this,"info"),"</p>",'<div class="copy-locales-to-container m-bottom-20 grid">'],e=0;return this.sandbox.util.foreach(this.localizations,function(c){e%2===0&&d.push((e>0?"</div>":"")+'<div class="grid-row">'),d.push(b.copyLocalesCheckbox.call(this,c.title,a)),e++}.bind(this)),d.push("</div>"),d.push("</div>"),d.join("")},copyLocalesCheckbox:function(a,b){var c,d=[];for(var e in this.data.concreteLanguages)this.data.concreteLanguages.hasOwnProperty(e)&&d.push(this.data.concreteLanguages[e]);return c=a===this.options.language&&d.indexOf(a)>=0,['<div class="grid-col-3">','   <div class="custom-checkbox">','       <input type="checkbox"','              id="copy-locales-to-',a,'"','              name="copy-locales-to" class="form-element" value="',a,'"',c?' disabled="disabled"':"","/>",'       <span class="icon"></span>',"   </div>",'   <label for="copy-locales-to-',a,'" class="',c?"disabled":"",'">',a,d.indexOf(a)<0?" *":"","   </label>","</div>"].join("")}},c=function(b){return this.sandbox.translate(a[b])},d=function(a,b,c,d,e){var f=this.getCopyLocaleUrl(a,b,c.join(","));this.sandbox.util.save(f,"POST",{}).then(function(a){d&&"function"==typeof d&&d(a)}.bind(this)).fail(function(a,b,c){e&&"function"==typeof e&&e(c)}.bind(this))},e=function(a){var b=this.sandbox.dom.data("#copy-locales-select","selection"),c=this.sandbox.dom.find('.copy-locales-to-container input:checked:not(input[disabled="disabled"])'),e=[];return this.sandbox.util.foreach(c,function(a){e.push(this.sandbox.dom.val(a))}.bind(this)),b&&0!==b.length&&0!==e.length?(this.sandbox.off("husky.select.copy-locale-to.deselected.item",h.bind(this)),this.sandbox.off("husky.select.copy-locale-to.selected.item",i.bind(this)),d.call(this,this.data.id,b[0],e),void a.resolve(e)):!1},f=function(a,d){this.sandbox.start([{name:"overlay@husky",options:{openOnStart:!0,removeOnClose:!0,el:a,container:this.$el,instanceName:"copy-locales",skin:"medium",slides:[{title:c.call(this,"title"),data:b.copyLocales.call(this,this.data),buttons:[{type:"cancel",align:"left"},{type:"ok",text:c.call(this,"ok"),align:"right"}],okCallback:function(){e.call(this,d)}.bind(this)}]}}])},g=function(a){this.sandbox.start([{name:"select@husky",options:{el:"#copy-locales-select",instanceName:"copy-locale-to",defaultLabel:c.call(this,"defaultLabel"),preSelectedElements:[this.options.language],data:a}}])},h=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled",""),this.sandbox.dom.removeClass('label[for="'+b+'"]',"disabled")},i=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled","disabled"),this.sandbox.dom.addClass('label[for="'+b+'"]',"disabled")};return{copyLocale:function(a,b,c,e,f){d.call(this,a,b,c,e,f)},startCopyLocalesOverlay:function(b){a=this.sandbox.util.extend(!0,{},a,b);var d=this.sandbox.data.deferred(),e=this.sandbox.dom.createElement('<div class="overlay-container"/>'),j=[],k=c.call(this,"currentLanguage");return this.sandbox.dom.append(this.$el,e),this.sandbox.util.foreach(this.data.concreteLanguages,function(a){j.push({id:a,name:a+(a===this.options.language?" ("+k+")":"")})}.bind(this)),this.sandbox.on("husky.select.copy-locale-to.deselected.item",h.bind(this)),this.sandbox.on("husky.select.copy-locale-to.selected.item",i.bind(this)),f.call(this,e,d),g.call(this,j),d.promise()}}});