define(["underscore","services/husky/expression"],function(a,b){"use strict";return{defaults:{options:{link:{},locale:null,webspace:null,url:"",hrefUrl:"",idKey:"id",titleKey:"title",publishedExpression:[],resultKey:null,searchFields:[],matchings:[],setHref:function(a,b,c){},selectCallback:function(a,b){}},templates:{skeleton:['<div class="grid">','   <div class="grid-row search-row">','       <div class="grid-col-8"/>','       <div class="grid-col-4 link-provider-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 link-provider-list" style="max-height: 500px; overflow: scroll;"/>',"   </div>","</div>"].join("")}},initialize:function(){this.resolveHref(),this.render()},resolveHref:function(){if(!this.options.link.href)return void this.options.setHref();var b=a.template(this.options.hrefUrl,this.options);this.sandbox.util.load(b).then(function(a){this.options.setHref(a[this.options.idKey],a[this.options.titleKey],this.isPublished(a))}.bind(this))},render:function(){var a=$(this.templates.skeleton());this.$el.append(a),this.sandbox.start([{name:"search@husky",options:{el:".link-provider-search",appearance:"white small",instanceName:"link-provider-search"}},{name:"datagrid@husky",options:{el:".link-provider-list",instanceName:"link-provider",url:this.options.url,resultKey:this.options.resultKey,sortable:!1,clickCallback:function(a,b){this.options.selectCallback(b[this.options.idKey],b[this.options.titleKey],this.isPublished(b))}.bind(this),selectedCounter:!1,searchInstanceName:"link-provider-search",searchFields:this.options.searchFields,paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:!1}},matchings:this.options.matchings}}])},typeChange:function(a){for(var b in config.types)if(config.types.hasOwnProperty(b)&&config.types[b].title===a.name&&this.type!==b)return this.type=b,this.sandbox.emit("husky.datagrid.article-link.url.update",{type:b});this.type=null,this.sandbox.emit("husky.datagrid.article-link.url.update",{type:null})},isPublished:function(a){return b.evaluate(this.options.publishedExpression,a)}}});