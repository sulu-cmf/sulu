define(["jquery","text!/admin/api/contacts/fields"],function(a,b){"use strict";var c={instanceName:"author-selection"},d={options:{nullableAuthor:!1,data:{authored:null,author:null},selectCallback:function(a){},matchings:JSON.parse(b)},translations:{authored:"sulu.content.form.settings.authored",noAuthor:"sulu.content.form.settings.no-author"},templates:{skeleton:['<div class="grid">','   <div class="grid-row form-group">','       <label for="authored"><%= translations.authored %></label>','       <div class="authored-component"','            data-aura-component="input@husky"','            data-aura-skin="date"','            data-value="<%= authored %>" />',"       </div>","   </div>",'   <div class="grid-row search-row">','       <div class="grid-col-8">',"<% if (nullableAuthor) { %>",'           <label for="no-author" class="m-top-5">','               <div class="custom-radio">','                   <input id="no-author" type="radio" class="form-element">','                   <span class="icon"></span>',"               </div>","               <%= translations.noAuthor %>","            </label>","<% } %>","       </div>",'       <div class="grid-col-4 author-selection-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 author-selection-list" style="max-height: 500px; overflow: scroll;"/>',"   </div>","</div>"].join("")}};return{defaults:d,initialize:function(){this.data=this.options.data,this.bindCustomEvents(),this.html(a(this.templates.skeleton({translations:this.translations,nullableAuthor:this.options.nullableAuthor,authored:this.options.data.authored?this.options.data.authored:null}))),this.sandbox.start([{name:"search@husky",options:{el:".author-selection-search",appearance:"white small",instanceName:c.instanceName+"-search"}},{name:"datagrid@husky",options:{el:".author-selection-list",instanceName:c.instanceName,url:"/admin/api/contacts?flat=true",resultKey:"contacts",sortable:!1,selectedCounter:!1,searchInstanceName:c.instanceName+"-search",searchFields:["fullName","mainEmail"],preselected:this.options.data.author?[this.options.data.author]:[],paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:{type:"radio"}}},matchings:this.options.matchings}}]),this.options.nullableAuthor&&this.initializeNullableRadio()},bindCustomEvents:function(){this.sandbox.once("sulu.content.contents.get-author",function(){this.data.authored=this.$el.find(".authored-component").data("value"),this.sandbox.emit("husky.datagrid."+c.instanceName+".items.get-selected",function(a,b){b.length>0&&(this.data.author=a[0],this.data.authorItem=b[0]),this.options.selectCallback(this.data)}.bind(this),!0)}.bind(this))},initializeNullableRadio:function(){var a=this.$el.find("#no-author"),b=this.data.author;this.data.author||a.prop("checked",!0),this.sandbox.on("husky.datagrid."+c.instanceName+".item.select",function(c){b=c,a.prop("checked",!1)}.bind(this)),a.on("click",function(){a.prop("checked")&&(this.sandbox.emit("husky.datagrid."+c.instanceName+".deselect.item",b),this.data.author=null,this.data.authorItem=null,b=null)}.bind(this))}}});