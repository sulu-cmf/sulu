define(["jquery","text!/admin/api/contacts/fields"],function(a,b){"use strict";var c={instanceName:"author-selection"},d={options:{formId:"authored-form",nullableAuthor:!1,data:{authored:null,authoredTime:null,author:null},selectCallback:function(a){},matchings:JSON.parse(b)},translations:{authored:"sulu.content.form.settings.authored",noAuthor:"sulu.content.form.settings.no-author"},templates:{skeleton:['   <div class="grid-row form-group">','       <label for="authored"><%= translations.authored %></label>','       <form id="<%= formId %>">','           <div class="grid-col-6">','              <div data-type="husky-input"','                  data-aura-component="input@husky"','                  data-mapper-property="authored"','                  data-validation-required="true"','                  data-aura-skin="date" />',"          </div>",'           <div class="grid-col-6">','              <div data-type="husky-input"','                  data-value="<%= authoredTime %>"','                  data-aura-component="input@husky"','                  data-mapper-property="authoredTime"','                  data-validation-required="true"','                  data-aura-skin="time" />',"          </div>","       </form>","   </div>",'   <div class="grid-row search-row">','       <div class="grid-col-8">',"<% if (nullableAuthor) { %>",'           <label for="no-author" class="m-top-5">','               <div class="custom-radio">','                   <input id="no-author" type="radio" name="datagrid-author-selection" class="form-element">','                   <span class="icon"></span>',"               </div>","               <%= translations.noAuthor %>","            </label>","<% } %>","       </div>",'       <div class="grid-col-4 author-selection-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 author-selection-list" style="max-height: 500px; overflow: scroll;"/>',"   </div>","</div>"].join("")}};return{defaults:d,initialize:function(){this.data=this.options.data,this.bindCustomEvents();var b="#"+this.options.formId,d=this.options.data.authored?this.options.data.authored:null,e=d?Globalize.format(app.sandbox.date.parse(d),Globalize.culture().calendar.patterns.t):null;this.html(a(this.templates.skeleton({translations:this.translations,nullableAuthor:this.options.nullableAuthor,authoredTime:e,formId:this.options.formId}))),this.form=this.sandbox.form.create(b),this.initialized.then(function(){this.sandbox.form.setData(b,{authored:d,authoredTime:e}).then(function(){this.sandbox.start(this),this.sandbox.start([{name:"search@husky",options:{el:".author-selection-search",appearance:"white small",instanceName:c.instanceName+"-search"}},{name:"datagrid@husky",options:{el:".author-selection-list",instanceName:c.instanceName,url:"/admin/api/contacts?flat=true",resultKey:"contacts",sortable:!1,selectedCounter:!1,searchInstanceName:c.instanceName+"-search",searchFields:["fullName","mainEmail"],preselected:this.options.data.author?[this.options.data.author]:[],paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:{type:"radio"}}},matchings:this.options.matchings}}])}.bind(this))}.bind(this)),this.options.nullableAuthor&&this.initializeNullableRadio()},bindCustomEvents:function(){this.sandbox.once("sulu.content.contents.get-author",function(){var a=this.form.mapper.getData();this.data.authored=Globalize.format(Globalize.parseDate(a.authored+" "+(a.authoredTime?a.authoredTime:"00:00:00"),"yyyy-MM-dd HH:mm:ss"),"yyyy'-'MM'-'dd'T'HH':'mm':'sszz'00'"),this.sandbox.emit("husky.datagrid."+c.instanceName+".items.get-selected",function(a,b){b.length>0&&(this.data.author=a[0],this.data.authorItem=b[0]),this.options.selectCallback(this.data)}.bind(this),!0)}.bind(this))},initializeNullableRadio:function(){var a=this.$el.find("#no-author"),b=this.data.author;this.data.author||a.prop("checked",!0),this.sandbox.on("husky.datagrid."+c.instanceName+".item.select",function(c){b=c,a.prop("checked",!1)}.bind(this)),a.on("click",function(){a.prop("checked")&&(this.sandbox.emit("husky.datagrid."+c.instanceName+".deselect.item",b),this.data.author=null,this.data.authorItem=null,b=null)}.bind(this))}}});