define(["text!./skeleton.html","text!./overlay.html"],function(a,b){"use strict";return{defaults:{options:{resultKey:"resourcelocators",url:null,pathKey:"resourceLocator"},translations:{showHistory:"public.show-history",title:"public.url-history",noHistory:"public.url-history.none"},templates:{skeleton:a,overlay:b}},initialize:function(){this.$el.html(this.templates.skeleton({translations:this.translations})),this.bindDomEvents()},bindDomEvents:function(){this.$el.on("click",".options-delete",this.deleteUrl.bind(this)),this.$el.find(".pointer").click(this.handleClick.bind(this))},deleteUrl:function(a){this.sandbox.sulu.showDeleteDialog(function(b){if(b){var c=this.sandbox.dom.$(a.currentTarget),d=this.sandbox.dom.parent(c),e=this.sandbox.dom.data(d,"id"),f=this.items[e]._links["delete"];"object"==typeof f&&(f=f.href),this.sandbox.util.save(f,"DELETE").then(function(){delete this.items[e],0===Object.keys(this.items).length&&this.sandbox.emit("husky.overlay.url-history.close"),this.sandbox.dom.remove(d)}.bind(this))}}.bind(this),"public.delete","sulu-content.resource-locator.delete")},handleClick:function(){this.load().then(this.startOverlay.bind(this))},load:function(){return this.startLoader(),this.sandbox.util.load(this.options.url).then(function(a){var b=a._embedded[this.options.resultKey];this.items={};for(var c=0,d=b.length;d>c;c++)this.items[b[c].id]=b[c];return b}.bind(this)).done(function(){this.stopLoader.call(this)}.bind(this))},startOverlay:function(a){var b=$("<div/>");this.$el.append(b),this.sandbox.start([{name:"overlay@husky",options:{el:b,container:b,openOnStart:!0,removeOnClose:!0,instanceName:"url-history",skin:"large",slides:[{title:this.translations.title,buttons:[{type:"ok",align:"center"}],data:this.templates.overlay({translations:this.translations,histories:a,crop:this.sandbox.util.cropMiddle,dateFormat:this.sandbox.date.format.bind(this.sandbox.date),pathKey:this.options.pathKey})}]}}])},startLoader:function(){var a=$("<div/>");this.$el.find(".loader").html(a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"16px",color:"#666666"}}])},stopLoader:function(){this.sandbox.stop(this.$el.find(".loader div"))}}});