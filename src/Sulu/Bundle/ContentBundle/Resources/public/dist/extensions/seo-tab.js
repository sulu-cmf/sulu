define(["jquery","config","text!/admin/content/template/content/seo.html"],function(a,b,c){"use strict";var d="#seo-form",e=b.get("sulu-content").seo,f={name:"seo-tab",defaults:{options:{maxTitleCharacters:e.max_title_length,maxDescriptionCharacters:e.max_description_length,maxKeywords:e.max_keywords,keywordsSeparator:e.keywords_separator,excerptUrlPrefix:e.url_prefix},templates:{form:c}},layout:{extendExisting:!0,content:{width:"fixed",rightSpace:!0,leftSpace:!0}},initialize:function(){this.tabInitialize(),this.title={$el:null,$counter:null},this.description={$el:null,$counter:null},this.keywords={$el:null,$counter:null,count:0},this.render(this.data),this.bindCustomEvents(),this.bindDomEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.tab.save",function(a){this.submit(a)},this)},bindDomEvents:function(){this.sandbox.dom.on(this.$el,"keyup",this.updateExcerpt.bind(this))},submit:function(a){this.sandbox.form.validate(d)&&(this.data=this.sandbox.form.getData(d),this.save(this.data,a))},render:function(a){this.data=a,this.$el.html(this.templates.form({sprintf:this.sandbox.util.sprintf,options:this.options,translate:this.sandbox.translate,siteUrl:this.getUrl(a)})),this.createForm(a),this.listenForChange()},createForm:function(a){this.sandbox.form.create(d).initialized.then(function(){this.sandbox.form.setData(d,a).then(function(){this.listenForChange(),this.updateExcerpt(),this.initializeTitleCounter(),this.initializeDescriptionCounter(),this.initializeKeywordsCounter()}.bind(this))}.bind(this))},initializeKeywordsCounter:function(){this.keywords.$el=this.$find("#seo-keywords"),this.keywords.$counter=this.$find("#keywords-left"),this.updateKeywordsCounter(),this.sandbox.dom.on(this.keywords.$el,"keyup",this.updateKeywordsCounter.bind(this))},updateExcerpt:function(){this.sandbox.dom.html(this.$find("#seo-excerpt-title"),this.sandbox.dom.val(this.$find("#seo-title"))),this.sandbox.dom.html(this.$find("#seo-excerpt-description"),this.sandbox.dom.val(this.$find("#seo-description")))},initializeTitleCounter:function(){this.title.$el=this.$find("#seo-title"),this.title.$counter=this.$find("#title-left"),this.updateTitleCounter(),this.sandbox.dom.on(this.title.$el,"keyup",this.updateTitleCounter.bind(this))},updateTitleCounter:function(){var a=this.options.maxTitleCharacters-this.sandbox.dom.val(this.title.$el).length;this.sandbox.dom.html(this.title.$counter," "+a+" "),this.toggleWarning(this.title.$counter.parent(),0>=a)},initializeDescriptionCounter:function(){this.description.$el=this.$find("#seo-description"),this.description.$counter=this.$find("#description-left"),this.updateDescriptionCounter(),this.sandbox.dom.on(this.description.$el,"keyup",this.updateDescriptionCounter.bind(this))},updateDescriptionCounter:function(){var a=this.options.maxDescriptionCharacters-this.sandbox.dom.val(this.description.$el).length;this.sandbox.dom.html(this.description.$counter," "+a+" "),this.toggleWarning(this.description.$counter.parent(),0>=a)},updateKeywordsCounter:function(){var a=this.sandbox.dom.trim(this.sandbox.dom.trim(this.sandbox.dom.val(this.keywords.$el)),this.options.keywordsSeparator),b=a.split(this.options.keywordsSeparator),c=this.options.maxKeywords;b=b.filter(function(a){return!!a}),this.keywords.count=b.length,c-=this.keywords.count,this.sandbox.dom.html(this.keywords.$counter,c),this.toggleWarning(this.keywords.$counter.parent(),0>c)},listenForChange:function(){this.sandbox.dom.on(d,"keyup change",function(){this.setHeaderBar()}.bind(this),".trigger-save-button")},toggleWarning:function(a,b){b?a.addClass("seo-warning"):a.removeClass("seo-warning")},loadComponentData:function(){var b=a.Deferred();return b.resolve(this.parseData(this.options.data())),b},tabInitialize:function(){this.sandbox.emit("sulu.tab.initialize",this.name)},setHeaderBar:function(){this.sandbox.emit("sulu.tab.dirty")},saved:function(a){this.sandbox.emit("sulu.tab.saved",a)},parseData:function(a){return a},save:function(a,b){throw new Error('"save" not implemented')},getUrl:function(a){throw new Error('"getUrl" not implemented')}};return{name:f.name,initialize:function(a){a.components.addType(f.name,f)}}});