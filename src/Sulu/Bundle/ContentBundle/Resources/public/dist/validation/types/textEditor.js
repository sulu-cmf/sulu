define(["jquery","type/default","form/util"],function(a,b,c){"use strict";var d=function(a,b){App.emit("sulu.content.changed");var c=b.prev();-1===a.indexOf('data-invalid="true"')?c.hide():c.show()},e=function(a,b){App.emit("sulu.preview.update",b,a,!0),d(a,b)},f=function(a,b){App.emit("sulu.preview.update",b,a),d(a,b)};return function(d,g){var h={instanceName:null},i=function(a){c.setValue(this.$el,this.getViewData.call(this,a))},j={initializeSub:function(){App.off("husky.ckeditor."+this.options.instanceName+".changed",e),App.on("husky.ckeditor."+this.options.instanceName+".changed",e),App.off("husky.ckeditor."+this.options.instanceName+".focusout",f),App.on("husky.ckeditor."+this.options.instanceName+".focusout",f)},needsValidation:function(){return!0},setValue:function(a){i.call(this,a),this.validate()},getModelData:function(a){return a.replace('data-invalid="true"',"")},validate:function(){var b=a.ajax("/admin/markup/validate",{type:"POST",data:this.getValue(),async:!1}),c=b.responseJSON;i.call(this,c.content);var d=this.$el.prev();return c.valid?d.hide():d.show(),!0}};return new b(d,h,g,"textEditor",j)}});