define(["underscore","text!./skeleton.html"],function(a,b){"use strict";var c={templates:{skeleton:b,url:'/admin/api/webspaces/<%= webspace.key %>/analytics<% if (!!id) { %>/<%= id %><% } %><% if (!!ids) { %>?ids=<%= ids.join(",") %><% } %>'},translations:{title:"public.title",type:"public.type",domains:"website.webspace.settings.domains",allDomains:"website.webspace.settings.all-domains",successLabel:"labels.success",successMessage:"labels.success.save-desc"}};return{defaults:c,tabOptions:{title:function(){return this.data.title}},layout:{content:{width:"max",leftSpace:!0,rightSpace:!0}},initialize:function(){this.render(),this.bindCustomEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.toolbar.add",this.editAnalytics.bind(this)),this.sandbox.on("sulu.toolbar.delete",this.deleteAnalytics.bind(this))},render:function(){this.html(this.templates.skeleton()),this.sandbox.start([{name:"list-toolbar@suluadmin",options:{el:"#webspace-analytics-list-toolbar",instanceName:"analytics",hasSearch:!1,template:this.sandbox.sulu.buttons.get({add:{},deleteSelected:{}})}},{name:"datagrid@husky",options:{el:"#webspace-analytics-list",url:this.templates.url({webspace:this.data,id:null,ids:null}),resultKey:"analytics",actionCallback:this.editAnalytics.bind(this),pagination:"infinite-scroll",viewOptions:{table:{actionIconColumn:"title"}},matchings:[{attribute:"title",content:this.translations.title},{attribute:"type",content:this.translations.type},{attribute:"domains",content:this.translations.domains,type:function(b){var c=a.map(b,function(a){return a.url});return c.join(", ")}},{attribute:"allDomains",content:this.translations.allDomains,type:"checkbox_readonly"}]}}])},editAnalytics:function(a){this.sandbox.start([{name:"webspace/settings/analytics/overlay@suluwebsite",options:{el:"#webspace-analytics-form-overlay",id:a,webspaceKey:this.data.key,urls:this.data.urls,saveCallback:this.save.bind(this),translations:this.translations}}])},save:function(a,b){this.sandbox.util.save(this.templates.url({webspace:this.data,id:a,ids:null}),a?"PUT":"POST",b).then(function(b){var c="husky.datagrid.record.add";a&&(c="husky.datagrid.records.change"),this.sandbox.emit(c,b),this.sandbox.emit("sulu.labels.success.show",this.translations.successMessage,this.translations.successLabel)}.bind(this))},deleteAnalytics:function(){var a=JSON.parse(JSON.stringify($("#webspace-analytics-list").data("selected")));this.sandbox.sulu.showDeleteDialog(function(b){b&&this.sandbox.util.save(this.templates.url({webspace:this.data,id:null,ids:a}),"DELETE").then(function(){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.sandbox.emit("husky.datagrid.record.remove",d)}}.bind(this))}.bind(this))},loadComponentData:function(){var a=this.sandbox.data.deferred();return a.resolve(this.options.data()),a.promise()}}});