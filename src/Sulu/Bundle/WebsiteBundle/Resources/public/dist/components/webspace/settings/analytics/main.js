define(["underscore","config","text!./skeleton.html"],function(a,b,c){"use strict";var d={templates:{skeleton:c,url:'/admin/api/webspaces/<%= webspace.key %>/analytics<% if (!!id) { %>/<%= id %><% } %><% if (!!ids) { %>?ids=<%= ids.join(",") %><% } %>'},translations:{title:"public.title",type:"public.type",domains:"website.webspace.settings.domains",allDomains:"website.webspace.settings.all-domains",successLabel:"labels.success",successMessage:"labels.success.save-desc"}};return{defaults:d,tabOptions:{title:function(){return this.data.title}},layout:{content:{width:"max"}},initialize:function(){this.render(),this.bindCustomEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.toolbar.add",this.editAnalytics.bind(this)),this.sandbox.on("sulu.toolbar.delete",this.deleteAnalytics.bind(this))},render:function(){this.html(this.templates.skeleton());var c=b.get("sulu_security.contexts")["sulu.webspace_settings."+this.data.key+".analytics"],d={},e=[{name:"datagrid@husky",options:{el:"#webspace-analytics-list",url:this.templates.url({webspace:this.data,id:null,ids:null}),resultKey:"analytics",actionCallback:this.editAnalytics.bind(this),pagination:"infinite-scroll",viewOptions:{table:{actionIconColumn:"title",actionIcon:c.edit?"pencil":"eye"}},matchings:[{name:"title",attribute:"title",content:this.translations.title},{name:"type",attribute:"type",content:this.translations.type},{name:"domains",attribute:"domains",content:this.translations.domains,type:function(b){if(b===!0)return this.translations.allDomains;var c=a.map(b,function(a){return a.url});return c.join(", ")}.bind(this)}]}}];c.add&&(d.add={}),c["delete"]&&(d.deleteSelected={}),a.isEmpty(d)||e.push({name:"list-toolbar@suluadmin",options:{el:"#webspace-analytics-list-toolbar",instanceName:"analytics",hasSearch:!1,template:this.sandbox.sulu.buttons.get(d)}}),this.sandbox.start(e)},editAnalytics:function(a){this.sandbox.start([{name:"webspace/settings/analytics/overlay@suluwebsite",options:{el:"#webspace-analytics-form-overlay",id:a,webspaceKey:this.data.key,urls:this.data.urls,saveCallback:this.save.bind(this),translations:this.translations}}])},save:function(a,b){this.sandbox.util.save(this.templates.url({webspace:this.data,id:a,ids:null}),a?"PUT":"POST",b).then(function(b){var c="husky.datagrid.record.add";a&&(c="husky.datagrid.records.change"),this.sandbox.emit(c,b),this.sandbox.emit("sulu.labels.success.show",this.translations.successMessage,this.translations.successLabel)}.bind(this))},deleteAnalytics:function(){var a=this.sandbox.util.deepCopy($("#webspace-analytics-list").data("selected"));this.sandbox.sulu.showDeleteDialog(function(b){b&&this.sandbox.util.save(this.templates.url({webspace:this.data,id:null,ids:a}),"DELETE").then(function(){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.sandbox.emit("husky.datagrid.record.remove",d)}}.bind(this))}.bind(this))},loadComponentData:function(){var a=this.sandbox.data.deferred();return a.resolve(this.options.data()),a.promise()}}});