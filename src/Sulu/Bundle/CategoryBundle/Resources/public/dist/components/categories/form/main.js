define(function(){"use strict";var a={activeTab:null,data:{},instanceName:"category",newCategoryTitle:"sulu.category.new-category"},b={DETAILS:"details"},c={detailsFromSelector:"#category-form",lastClickedCategorySettingsKey:"categoriesLastClicked"};return{view:!0,templates:["/admin/category/template/category/form/details"],initialize:function(){this.options=this.sandbox.util.extend(!0,{},a,this.options),this.saved=!0,this.bindCustomEvents(),this.render(),this.options.data.id&&this.sandbox.sulu.saveUserSetting(c.lastClickedCategorySettingsKey,this.options.data.id)},bindCustomEvents:function(){this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.category.categories.list")}.bind(this)),this.sandbox.on("sulu.toolbar.save",this.saveDetails.bind(this)),this.sandbox.on("sulu.toolbar.delete",this.deleteCategory.bind(this))},render:function(){this.options.activeTab===b.DETAILS&&this.renderDetails()},renderDetails:function(){this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/category/template/category/form/details")),this.sandbox.form.create(c.detailsFromSelector),this.sandbox.form.setData(c.detailsFromSelector,this.options.data).then(function(){this.bindDetailsDomEvents()}.bind(this))},bindDetailsDomEvents:function(){this.sandbox.dom.on(c.detailsFromSelector,"change keyup",function(){this.saved===!0&&(this.sandbox.emit("sulu.header.toolbar.item.enable","save-button",!1),this.saved=!1)}.bind(this))},deleteCategory:function(){this.options.data.id&&this.sandbox.emit("sulu.category.categories.delete",[this.options.data.id],null,function(){this.sandbox.sulu.unlockDeleteSuccessLabel(),this.sandbox.emit("sulu.category.categories.list")}.bind(this))},saveDetails:function(a){if(this.sandbox.form.validate(c.detailsFromSelector)){var b=this.sandbox.form.getData(c.detailsFromSelector);this.options.data=this.sandbox.util.extend(!0,{},this.options.data,b),this.sandbox.emit("sulu.header.toolbar.item.loading","save-button"),this.sandbox.emit("sulu.category.categories.save",this.options.data,this.savedCallback.bind(this,!this.options.data.id,a))}},savedCallback:function(a,b,c,d){d===!0?(this.sandbox.emit("sulu.header.toolbar.item.disable","save-button",!0),this.saved=!0,"back"===b?this.sandbox.emit("sulu.category.categories.list"):"new"===b?this.sandbox.emit("sulu.category.categories.form-add",this.options.parent):a===!0&&this.sandbox.emit("sulu.category.categories.form",c.id),this.sandbox.emit("sulu.labels.success.show","labels.success.category-save-desc","labels.success")):(this.sandbox.emit("sulu.header.toolbar.item.enable","save-button",!1),1===c.code?this.sandbox.emit("sulu.labels.error.show","labels.error.category-unique-key","labels.error"):this.sandbox.emit("sulu.labels.error.show","labels.success.category-save-error","labels.error"))}}});