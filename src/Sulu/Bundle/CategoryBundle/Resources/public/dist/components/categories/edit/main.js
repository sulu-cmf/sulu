define(["jquery","config","services/sulucategory/category-manager","services/sulucategory/category-router"],function(a,b,c,d){"use strict";var e=b.get("sulu_category.user_settings.category_locale");return{collaboration:function(){return this.data&&this.data.id?{id:this.data.id,type:"categories"}:void 0},header:function(){return{title:this.data.title,tabs:{url:"/admin/content-navigations?alias=category",options:{data:function(){return this.sandbox.util.extend(!1,{},this.data)}.bind(this),locale:this.options.locale},componentOptions:{values:this.data}},toolbar:{buttons:{save:{parent:"saveWithOptions"},edit:{options:{dropdownItems:{"delete":{}}}}},languageChanger:{preSelected:this.options.locale}}}},loadComponentData:function(){return this.options.id?c.load(this.options.id,this.options.locale):{}},initialize:function(){this.bindCustomEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.header.back",this.toList.bind(this)),this.sandbox.on("sulu.tab.dirty",this.enableSave.bind(this)),this.sandbox.on("sulu.toolbar.save",this.save.bind(this)),this.sandbox.on("sulu.toolbar.delete",this["delete"].bind(this)),this.sandbox.on("sulu.tab.data-changed",this.setData.bind(this)),this.sandbox.on("sulu.header.language-changed",this.changeLanguage.bind(this))},toList:function(){d.toList(this.options.locale)},toNew:function(a,b,c){d.toNew(a||this.options.locale,b||"details",c||this.options.parent)},toEdit:function(a,b,c){d.toEdit(b||this.options.locale,a,c||"details")},save:function(a){this.loadingSave(),this.saveTab().then(function(b){this.afterSave(a,b)}.bind(this))},"delete":function(){this.options.id&&this.sandbox.sulu.showDeleteDialog(function(a){a&&c["delete"](this.options.id,this.options.locale).then(function(){this.sandbox.sulu.unlockDeleteSuccessLabel(),d.toList(this.options.locale)}.bind(this))}.bind(this))},setData:function(a){this.data=a},saveTab:function(){var b=a.Deferred();return this.sandbox.once("sulu.tab.saved",function(a){this.setData(a),b.resolve(a)}.bind(this)),this.sandbox.emit("sulu.tab.save"),b},enableSave:function(){this.sandbox.emit("sulu.header.toolbar.item.enable","save",!1)},loadingSave:function(){this.sandbox.emit("sulu.header.toolbar.item.loading","save")},changeLanguage:function(a){var b=a.id;this.sandbox.sulu.saveUserSetting(e,b),this.options.id?this.toEdit(this.options.id,b,this.options.content):this.toNew(b,this.options.content)},afterSave:function(a,b){this.sandbox.emit("sulu.header.toolbar.item.disable","save",!0),this.sandbox.emit("sulu.header.saved",b),"back"===a?this.toList():"new"===a?this.toNew():this.options.id||this.toEdit(b.id)}}});