define(["jquery","services/sulucategory/category-manager","services/sulucategory/category-router"],function(a,b,c){"use strict";var d={toolbarSelector:"#list-toolbar-container",listSelector:"#categories-list",lastClickedCategorySettingsKey:"categoriesLastClicked"};return{stickyToolbar:!0,layout:{content:{width:"max"}},header:function(){return{noBack:!0,title:"category.categories.title",underline:!1,toolbar:{buttons:{add:{},deleteSelected:{options:{callback:function(){this.sandbox.emit("husky.datagrid.items.get-selected",this.deleteSelected.bind(this))}.bind(this)}},moveSelected:{options:{icon:"arrows",title:"sulu.category.move",disabled:!0,callback:function(){this.sandbox.emit("husky.datagrid.items.get-selected",this.moveSelected.bind(this))}.bind(this)}},"export":{options:{urlParameter:{flat:!0,locale:this.options.locale},url:"/admin/api/categories.csv"}}},languageChanger:{preSelected:this.options.locale}}}},templates:["/admin/category/template/category/list"],initialize:function(){this.locale=this.options.locale,this.sandbox.sulu.triggerDeleteSuccessLabel("labels.success.category-delete-desc"),this.bindCustomEvents(),this.render()},bindCustomEvents:function(){this.sandbox.on("sulu.header.language-changed",this.changeLanguage.bind(this)),this.sandbox.on("husky.datagrid.item.click",this.saveLastClickedCategory.bind(this)),this.sandbox.on("sulu.toolbar.add",this.addNewCategory.bind(this)),this.sandbox.on("husky.datagrid.number.selections",function(a){var b=a>0?"enable":"disable";this.sandbox.emit("sulu.header.toolbar.item."+b,"deleteSelected",!1),this.sandbox.emit("sulu.header.toolbar.item."+b,"moveSelected",!1)}.bind(this))},changeLanguage:function(a){this.locale=a.id},render:function(){this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/category/template/category/list")),this.sandbox.sulu.initListToolbarAndList.call(this,"categories","/admin/api/categories/fields?locale="+this.locale,{el:this.$find(d.toolbarSelector),template:"default",instanceName:this.instanceName},{el:this.$find(d.listSelector),url:"/admin/api/categories?flat=true&sortBy=name&sortOrder=asc&locale="+this.locale,childrenPropertyName:"hasChildren",expandIds:[this.sandbox.sulu.getUserSetting(d.lastClickedCategorySettingsKey)],resultKey:"categories",storageName:"categories",searchFields:["name"],pagination:!1,actionCallback:this.editCategory.bind(this),viewOptions:{table:{hideChildrenAtBeginning:!1,cropContents:!1,selectItem:{type:"checkbox",inFirstCell:!0},icons:[{column:"name",icon:"plus-circle",callback:this.addNewCategory.bind(this)}],badges:[{column:"name",callback:function(a,b){return a.defaultLocale===a.locale&&a.locale!==this.locale?(b.title=a.locale,b):void 0}.bind(this)}],cssClasses:[{column:"name",callback:function(a){return a.defaultLocale===a.locale&&a.locale!==this.locale?"row-gray":void 0}.bind(this)}]}}})},addNewCategory:function(a){this.saveLastClickedCategory(a),this.sandbox.emit("sulu.category.categories.form-add",a)},editCategory:function(a){this.saveLastClickedCategory(a),this.sandbox.emit("sulu.category.categories.form",a)},saveLastClickedCategory:function(a){a&&this.sandbox.sulu.saveUserSetting(d.lastClickedCategorySettingsKey,a)},deleteSelected:function(a){this.sandbox.emit("sulu.category.categories.delete",a,function(a){this.sandbox.emit("husky.datagrid.record.remove",a)}.bind(this),function(){this.sandbox.emit("sulu.labels.success.show","labels.success.category-delete-desc","labels.success")}.bind(this))},moveSelected:function(d){var e=a("<div/>");this.$el.append(e),this.sandbox.start([{name:"categories/list/move-overlay@sulucategory",options:{el:e,locale:this.options.locale,selectCallback:function(e){for(var f=[],g=0;g<d.length;g++)f.push(b.move(d[g],this.options.locale,e));a.when.apply(a,f).done(function(){this.saveLastClickedCategory(e),c.toList(this.options.locale)}.bind(this))}.bind(this)}}])}}});