define(["services/sulusecurity/role-router","sulusecurity/models/role"],function(a,b){"use strict";var c={datagridInstanceName:"roles"};return{name:"Sulu Security Role",collaboration:function(){return this.options.id?{id:this.options.id,type:"roles"}:void 0},initialize:function(){this.idDelete=null,this.loading="delete","list"===this.options.display?this.renderList():"form"===this.options.display&&(this.role=this.options.data(),this.renderForm()),this.bindCustomEvents()},bindCustomEvents:function(){this.sandbox.on("sulu.roles.new",a.toAdd),this.sandbox.on("sulu.roles.load",a.toEdit),this.sandbox.on("sulu.roles.list",a.toList),this.sandbox.on("sulu.roles.save",function(a,b){this.save(a,b)}.bind(this)),this.sandbox.on("sulu.role.delete",function(a){this.loading="delete",this.del(a)}.bind(this)),this.sandbox.on("sulu.roles.delete",function(a){this.loading="add",this.del(a)}.bind(this))},save:function(b,c){this.sandbox.emit("sulu.header.toolbar.item.loading","save"),this.role.set(b),this.role.save(b,{success:function(b){this.sandbox.emit("sulu.header.toolbar.item.enable","save"),this.sandbox.emit("sulu.labels.warning.show","security.warning"),this.options.id&&(this.sandbox.emit("sulu.role.saved",b.id),this.sandbox.emit("sulu.header.saved",b.toJSON())),"back"===c?a.toList():"new"===c?a.toAdd():this.options.id||a.toEdit(b.id)}.bind(this),error:function(a,b){this.showErrorLabel(b.responseJSON.code),this.sandbox.logger.log("An error occured while saving a role"),this.sandbox.emit("sulu.header.toolbar.item.enable","save")}.bind(this)})},showErrorLabel:function(a){var b="";switch(a){case 1101:b="security.roles.error.non-unique"}this.sandbox.emit("sulu.labels.error.show",b,"labels.error","")},del:function(a){this.idDelete=a,this.sandbox.sulu.showDeleteDialog(function(a){a&&(this.sandbox.emit("sulu.header.toolbar.item.loading","options-button"),"number"==typeof this.idDelete||"string"==typeof this.idDelete?this.delSubmitOnce(this.idDelete,!0):this.sandbox.util.each(this.idDelete,function(a,b){this.delSubmitOnce(b,!1)}.bind(this)))}.bind(this))},delSubmitOnce:function(d,e){null===this.role&&(this.role=new b),this.role.set({id:d}),this.role.destroy({success:function(){e?a.toList():this.sandbox.emit("husky.datagrid."+c.datagridInstanceName+".record.remove",d)}.bind(this),error:function(){this.sandbox.emit("husky.header.button-state","standard")}.bind(this)})},renderList:function(){var a=this.sandbox.dom.createElement('<div id="roles-list-container"/>');this.html(a),this.sandbox.start([{name:"roles/components/list@sulusecurity",options:{el:a}}])},renderForm:function(){var a=this.sandbox.dom.createElement('<div id="roles-form-container"/>');this.html(a),this.sandbox.start([{name:"roles/components/form@sulusecurity",options:{el:a,data:this.role.toJSON()}}])}}});