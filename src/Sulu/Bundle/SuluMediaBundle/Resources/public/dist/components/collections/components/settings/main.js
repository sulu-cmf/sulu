define(function(){"use strict";var a={data:{},instanceName:"collection"},b={settingsFormId:"collection-settings"};return{view:!0,layout:{content:{width:"fixed"}},templates:["/admin/media/template/collection/settings"],initialize:function(){this.options=this.sandbox.util.extend(!0,{},a,this.options),this.saved=!0,this.bindCustomEvents(),this.render()},bindCustomEvents:function(){this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.media.collections.list")}.bind(this)),this.sandbox.on("sulu.header.language-changed",this.changeLanguage.bind(this)),this.sandbox.on("sulu.header.toolbar.save",this.save.bind(this))},deleteCollection:function(){this.sandbox.emit("sulu.media.collections.delete-collection",this.options.data.id,function(){this.sandbox.sulu.unlockDeleteSuccessLabel(),this.sandbox.emit("sulu.media.collections.collection-list")}.bind(this))},changeLanguage:function(a){this.sandbox.emit("sulu.header.toolbar.item.loading","language"),this.sandbox.emit("sulu.media.collections.reload-collection",this.options.data.id,{locale:a},function(a){this.options.data=a,this.sandbox.form.setData("#"+b.settingsFormId,this.options.data),this.setHeaderInfos(),this.sandbox.emit("sulu.header.toolbar.item.enable","language",!1)}.bind(this)),this.sandbox.emit("sulu.media.collections-edit.set-locale",a)},render:function(){this.setHeaderInfos(),this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/media/template/collection/settings")),this.sandbox.start("#"+b.settingsFormId),this.sandbox.form.create("#"+b.settingsFormId),this.sandbox.form.setData("#"+b.settingsFormId,this.options.data).then(function(){this.startToolbar(),this.bindDomEvents()}.bind(this))},bindDomEvents:function(){this.sandbox.dom.on("#"+b.settingsFormId,"change keyup",function(){this.saved===!0&&(this.sandbox.emit("sulu.header.toolbar.state.change","edit",!1),this.saved=!1)}.bind(this))},startToolbar:function(){this.sandbox.emit("sulu.header.set-toolbar",{template:"save",parentTemplate:[{id:"delete",icon:"trash-o",title:this.sandbox.translate("sulu.collections.delete-collection"),callback:this.deleteCollection.bind(this)}],languageChanger:{preSelected:this.options.locale}})},setHeaderInfos:function(){this.sandbox.emit("sulu.header.set-title",this.options.data.title),this.sandbox.emit("sulu.header.set-breadcrumb",[{title:"navigation.media"},{title:"media.collections.title",event:"sulu.media.collections.list"},{title:this.options.data.title}])},save:function(){if(this.sandbox.form.validate("#"+b.settingsFormId)){var a=this.sandbox.form.getData("#"+b.settingsFormId);this.options.data=this.sandbox.util.extend(!0,{},this.options.data,a),this.sandbox.emit("sulu.header.toolbar.item.loading","save-button"),this.sandbox.once("sulu.media.collections.collection-changed",this.savedCallback.bind(this)),this.sandbox.emit("sulu.media.collections.save-collection",this.options.data)}},savedCallback:function(){this.setHeaderInfos(),this.sandbox.emit("sulu.header.toolbar.state.change","edit",!0,!0),this.saved=!0,this.sandbox.emit("sulu.labels.success.show","labels.success.collection-save-desc","labels.success")}}});