define(["sulucontact/model/account"],function(a){"use strict";var b={datagridInstanceName:"accounts"},c={dialogEntityFoundTemplate:["<p><%= foundMessage %>:</p>",'<% if (typeof list !== "undefined") { %>',"<ul><%= list %></ul>","<% } %>",'<% if (typeof numChildren !== "undefined" && numChildren > 3 && typeof andMore !== "undefined") { %>',"<p><%= andMore %></p>","<% } %>","<p><%= description %></p>",'<% if (typeof checkboxText !== "undefined") { %>',"<p>",'   <label for="overlay-checkbox">','       <div class="custom-checkbox">','           <input type="checkbox" id="overlay-checkbox" class="form-element" />','           <span class="icon"></span>',"       </div>","       <%= checkboxText %>","</label>","</p>","<% } %>"].join("")},d=function(a,b){var c="/admin/api/accounts/"+a+"/deleteinfo";this.sandbox.util.ajax({headers:{"Content-Type":"application/json"},context:this,type:"GET",url:c,success:function(c){e.call(this,c,a,b)}.bind(this),error:function(a,b,c){this.sandbox.logger.error("error during get request: "+b,c)}.bind(this)})},e=function(a,b,d){if(d&&"function"!=typeof d)throw"callback is not a function";var e,g,h="contact.accounts.delete.desc",i="show-warning",j="sulu.overlay.be-careful",k=function(){var a=this.sandbox.dom.find("#overlay-checkbox").length&&this.sandbox.dom.prop("#overlay-checkbox","checked");d.call(this,!0,a)}.bind(this);parseInt(a.numChildren,10)>0?(e=a.numChildren-a.children.length,i="show-error",j="sulu.overlay.error",k=void 0,h=this.sandbox.util.template(c.dialogEntityFoundTemplate,{foundMessage:this.sandbox.translate("contact.accounts.delete.sub-found"),list:f.dependencyListAccounts.call(this,a.children),numChildren:parseInt(a.numChildren,10),andMore:this.sandbox.util.template(this.sandbox.translate("public.and-number-more"),{number:e}),description:this.sandbox.translate("contact.accounts.delete.sub-found-desc")})):parseInt(a.numContacts,10)>0&&(g=a.numContacts-a.contacts.length,h=this.sandbox.util.template(c.dialogEntityFoundTemplate,{foundMessage:this.sandbox.translate("contact.accounts.delete.contacts-found"),list:f.dependencyListContacts.call(this,a.contacts),numChildren:parseInt(a.numContacts,10),andMore:this.sandbox.util.template(this.sandbox.translate("public.and-number-more"),{number:g}),description:this.sandbox.translate("contact.accounts.delete.contacts-question"),checkboxText:this.sandbox.util.template(this.sandbox.translate("contact.accounts.delete.contacts-checkbox"),{number:parseInt(a.numContacts,10)})})),this.sandbox.emit("sulu.overlay."+i,j,h,d.bind(this,!1),k)},f={dependencyListContacts:function(a){var b="<% _.each(contacts, function(contact) { %> <li><%= contact.firstName %> <%= contact.lastName %></li> <% }); %>";return this.sandbox.template.parse(b,{contacts:a})},dependencyListAccounts:function(a){var b="<% _.each(accounts, function(account) { %> <li><%= account.name %></li> <% }); %>";return this.sandbox.template.parse(b,{accounts:a})}},g=function(a,c){a&&(this.sandbox.emit("sulu.header.toolbar.item.loading","options-button"),this.account.destroy({data:{removeContacts:!!c},processData:!0,success:function(){this.recordRemove&&this.sandbox.emit("husky.datagrid."+b.datagridInstanceName+".record.remove",this.account.get("id")),this.sandbox.emit("sulu.router.navigate","contacts/accounts")}.bind(this)}))},h=function(a,b,d){if(d&&"function"!=typeof d)throw"callback is not a function";var e="contact.accounts.delete.desc",f="sulu.overlay.be-careful",g="show-warning",h=function(){var a=this.sandbox.dom.find("#delete-contacts").length&&this.sandbox.dom.prop("#delete-contacts","checked");d(!0,a)}.bind(this);parseInt(a.numChildren,10)>0?(g="show-error",f="sulu.overlay.error",h=void 0,e=this.sandbox.util.template(c.dialogEntityFoundTemplate,{foundMessage:this.sandbox.translate("contact.accounts.delete.sub-found"),description:this.sandbox.translate("contact.accounts.delete.sub-found-desc")})):parseInt(a.numContacts,10)>0&&(e=this.sandbox.util.template(c.dialogEntityFoundTemplate,{foundMessage:this.sandbox.translate("contact.accounts.delete.contacts-found"),numChildren:parseInt(a.numContacts,10),description:this.sandbox.translate("contact.accounts.delete.contacts-question"),checkboxText:this.sandbox.util.template(this.sandbox.translate("contact.accounts.delete.contacts-checkbox"),{number:parseInt(a.numContacts,10)})})),this.sandbox.emit("sulu.overlay."+g,f,e,d.bind(this,!1),h)},i=function(c,d){c&&this.ids.forEach(function(c){var e=a.findOrCreate({id:c});e.destroy({data:{removeContacts:!!d},processData:!0,success:function(){this.sandbox.emit("husky.datagrid."+b.datagridInstanceName+".record.remove",c)}.bind(this)})}.bind(this))};return{showForSingle:function(a,b,c,e){a&&b&&c&&(this.sandbox=a,this.account=b,this.recordRemove=e,d.call(this,c,g.bind(this)))},showForMultiple:function(a,b){if(a&&b){this.sandbox=a,this.ids=b;var c="/admin/api/accounts/multipledeleteinfo";this.sandbox.util.ajax({headers:{"Content-Type":"application/json"},context:this,type:"GET",url:c,data:{ids:b},success:function(a){h.call(this,a,b,i.bind(this))}.bind(this),error:function(a,b,c){this.sandbox.logger.error("error during get request: "+b,c)}.bind(this)})}}}});