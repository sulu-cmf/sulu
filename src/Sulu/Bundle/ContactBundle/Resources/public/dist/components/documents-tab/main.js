define(["services/sulucontact/account-manager","services/sulucontact/contact-manager"],function(a,b){"use strict";return{stickyToolbar:140,layout:function(){return{content:{width:"fixed"}}},templates:["/admin/contact/template/basic/documents"],initialize:function(){this.manager="contact"===this.options.type?b:a,this.data=this.options.data(),this.bindCustomEvents(),this.render()},render:function(){this.html(this.renderTemplate(this.templates[0])),this.startSelectionOverlay(),this.initList()},bindCustomEvents:function(){this.sandbox.on("sulu.tab.save",this.saveMedias,this),this.sandbox.on("husky.datagrid.documents.number.selections",function(a){var b=a>0?"enable":"disable";this.sandbox.emit("husky.toolbar.documents.item."+b,"deleteSelected",!1)},this),this.sandbox.on("husky.datagrid.documents.records.remove",function(){this.sandbox.emit("sulu.tab.dirty")},this),this.sandbox.on("husky.datagrid.documents.records.set",function(){this.sandbox.emit("sulu.tab.dirty")},this)},saveMedias:function(){this.sandbox.emit("sulu.tab.saving"),this.sandbox.emit("husky.datagrid.documents.records.get",function(a){var b=_.map(a,function(a){return a.id});this.manager.setDocuments(this.data.id,b).then(function(a){this.sandbox.emit("sulu.tab.saved",a,!0)}.bind(this))}.bind(this))},showAddOverlay:function(){this.sandbox.emit("husky.datagrid.documents.records.get",function(a){this.sandbox.emit("sulu.media-selection-overlay.document-selection.set-items",a),this.sandbox.emit("sulu.media-selection-overlay.document-selection.open")}.bind(this))},removeSelected:function(){this.sandbox.emit("husky.datagrid.documents.items.get-selected",function(a){this.sandbox.emit("husky.datagrid.documents.records.remove",a)}.bind(this))},initList:function(){var a=this.manager.getDocumentsData(this.data.id);this.sandbox.sulu.initListToolbarAndList.call(this,a.fieldsKey,a.fieldsUrl,{el:this.$find("#list-toolbar-container"),instanceName:"documents",hasSearch:!1,template:this.getListTemplate()},{el:this.$find("#documents-list"),url:a.listUrl,instanceName:"documents",resultKey:"media",searchFields:["name","title","description"],sortable:!1,clickCallback:function(a,b){window.location.href=b.url},viewOptions:{table:{selectItem:{type:"checkbox"}}}})},getListTemplate:function(){return this.sandbox.sulu.buttons.get({edit:{options:{"class":"highlight",callback:this.showAddOverlay.bind(this)}},deleteSelected:{options:{callback:this.removeSelected.bind(this)}}})},startSelectionOverlay:function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"media-selection/overlay@sulumedia",options:{el:a,instanceName:"document-selection",removeable:!1,saveCallback:function(a){this.sandbox.emit("husky.datagrid.documents.records.set",a)}.bind(this)}}])}}});