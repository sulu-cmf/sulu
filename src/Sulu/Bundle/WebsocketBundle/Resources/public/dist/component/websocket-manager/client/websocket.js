define(["websocket/abstract","jquery"],function(a,b){var c=function(b,c,d){a.call(this,b,d),this.type=a.TYPE_WEBSOCKET,this.socket=c,this.messages={},this.socket.onmessage=function(a){var b=JSON.parse(a.data);this._onMessage.notify(b),b.options&&b.options.id&&this.messages[b.options.id]?(b.error?this.messages[b.options.id].reject(b.handler,b.message):this.messages[b.options.id].resolve(b.handler,b.message),this.messages[b.options.id]=null):b.handler&&this.handlers[b.handler]&&this.handlers[b.handler].notify(b.message)}.bind(this)};return c.prototype=Object.create(a.prototype),c.prototype.doSend=function(a,c){var d=this.generateUuid();return this.messages[d]=b.Deferred(),this.socket.send(this.generateMessage(a,c,{id:d})),this.messages[d]},c});